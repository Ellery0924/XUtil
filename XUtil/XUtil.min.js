!function(a){"function"==typeof define&&define.amd?define(["jquery","jquery-ui"],a):a(jQuery)}(function($){"use strict";var XUtil={},exports=window;return XUtil.config={rootPath:"XUtil"},XUtil.helpers={log:function(){var a=Array.prototype.slice.apply(arguments,[]);a.unshift("(XUtil) "),console.log.apply(console,a)},error:function(){if(arguments[0]){var a="(XUtil) "+arguments[0].toString();return new Error(a)}},bindInput:function(a,b){var c=b||"data-bind",d=XUtil.helpers.bindInput,e={};if(a){if("string"==typeof a)void 0===b?(e={},e[a]="",d.call(window,e)):(e={},e[a]=b,d.call(window,e));else for(var f in a)if(a.hasOwnProperty(f))for(var g=$(f),h=0;h<g.length;h++){var i=$(f).eq(h),j=(a[f]||(i.attr(c)?i.attr(c):"")).toString(),k=i.is("input[type=text]"),l=i.is("textarea"),m=i.is("input[type=hidden]"),n=i.is("input[type=checkbox]"),o=i.is("input[type=radio]"),p=i.is("select");k||l||m||p?(i.val(j),i.trigger("change")):(n||o)&&("true"===j?(i.prop("checked",!0),i.trigger("change")):"false"===j&&(i.prop("checked",!1),i.trigger("change")))}}else e["["+c+"]"]="",d.call(window,e)},addShield:function(a,b,c){var d,e,f,g,h,i=c||1e4;return!a&&(a=document.body),a=$(a),d=a.offset().top,e=a.offset().left,f=a.outerWidth(),g=a.outerHeight(),a[0]===document.body&&(f="100%",g="100%"),$.isNumeric(b)||(b=.3),h=$("<div class='XUtil-pageShield'></div>"),h.css("position","absolute").css("z-index",i).css("background","#000").css("opacity",b).css("top",d).css("left",e).css("width",f).css("height",g).appendTo(document.body),h},removeShield:function(a){a?$(".XUtil-pageShield").remove():$(a).remove()},showErrorHint:function(a,b,c){var d=$(a.parentNode),e=$("<span class='errorHint'>* "+b+"</span>");return 0===d.find(".errorHint").length&&e.insertAfter(a),c&&e.addClass(c),e},clearErrorHint:function(a){a?$($(a).parent()).find(".errorHint").remove():$(".errorHint").remove()},getUrlArgs:function(){var a,b,c,d,e={},f=window.location||f,g=f.search.substring(1),h=g.split("&");for(a=0;a<h.length;a++)b=h[a].indexOf("="),-1!==b&&(c=h[a].substring(0,b),d=decodeURI(h[a].substring(b+1)),e[c]=d);return e},toQuery:function(a){var b="?";for(var c in a)a.hasOwnProperty(c)&&(b+=c+"="+a[c]+"&");return b},getUrl:function(a,b){var c=helpers;return encodeURI(a+c.toQuery(b))},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:0&b&3|8;return c.toString(16)}).toUpperCase()},preloadImages:function(){var a;for(a=0;a<arguments.length;a++)(new Image).src=arguments[a].toString()}},XUtil.XAccordion=function(a){var b,c=XUtil.helpers.error,d=XUtil.helpers.log,e=[],f={},g=a.titles||[],h=a.id||"XAccordion-"+XUtil.helpers.guid(),i=a.animated||!1,j=$.isFunction(a.onShow)?a.onOpen:function(a){d("XAccordion: Container "+a.index+" is open")},k=$.isFunction(a.onRemove)?a.onRemove:function(a){return d("XAccordion: Container "+a.index+" is removed."),!0},l=a.closable||!1,m=a.className||"",n=a.iconClass||"";if(!("renderTo"in a&&$(a.renderTo)[0]))throw c("XAccordion: 目标div不合法，请检查option.renderTo属性！");b=a.renderTo;var o,p,q,r=$(b),s=function(a,b){var d,f,g,h,i="<div class='XAccordion-title'><span class='icon'></span><span class='titleText'></span><span class='closebtn'></span></div>",j="<div xa-title='"+b+" 'class='XAccordion-content'></div>",k="<div class='XAccordion-container'></div>";if(a=$(a)[0],!a)throw c("XAccordion.append: 要添加的dom元素不合法，请检查！");d={title:b,titleNode:void 0,contentNode:void 0,domNode:void 0,opened:!1},g=$(j).append(a),f=$(i),f.find(".titleText").html(b),h=$(k).append(f).append(g),d.titleNode=f,d.contentNode=g,d.domNode=h,e.push(d)},t=r.children();for(o=0;o<t.length;o++)p=t[o],q=""===g[o]?$(p).attr("xa-title"):g[o],$(p).removeAttr("xa-title"),s(p,q);return r.on("click",".titleText",function(){var a=$(this.parentNode.parentNode).attr("xa-index");f.show(a)}),r.on("click",".closebtn",function(){var a=$(this.parentNode.parentNode).attr("xa-index");f.remove(a)}),f.containers=e,f.titles=g,f.set=function(a){return"animated"in a&&(i=Boolean(a.animated)),$.isFunction(a.onShow)&&(j=a.onShow),$.isFunction(a.onRemove)&&(k=a.onRemove),"closable"in a&&(l=Boolean(a.closable)),"className"in a&&(m=a.className),"iconClass"in a&&(n=a.iconClass),"id"in a&&(h=a.id),f},f.show=function(a){var b;for(b=0;b<e.length;b++)b!==parseInt(a)&&f.hide(b);return e[a].opened||(i?e[a].contentNode.slideDown("fast"):e[a].contentNode.show(),e[a].opened=!0,e[a].domNode.addClass("opened"),j(e[a])),f},f.hide=function(a){return e[a].opened=!1,i?e[a].contentNode.slideUp("fast"):e[a].contentNode.hide(),e[a].domNode.removeClass("opened"),f},f.remove=function(a){return k(e[a])&&(e.splice(a,1),f.init()),f},f.append=function(a,b){return s(a,b),f.init(),f},f.init=function(){if(r.empty(),r.addClass("XAccordion").addClass(m).attr("xa-id",h),e.length>0){for(o=0;o<e.length;o++)r.append(e[o].domNode),e[o].domNode.attr("xa-index",o),e[o].index=o,0!==o&&(e[o].contentNode.hide(),e[o].opened=!1);l||r.find(".closebtn").hide(),r.find(".icon").addClass(n),e[0].contentNode.show(),e[0].opened=!0,e[0].domNode.addClass("opened")}return f},f.init(),f},XUtil.XDialog=function(a){var b,c,d,e,f,g,h,i,j,k=XUtil.helpers,l=k.log,m=a.width||"auto",n=a.height||"auto",o=a.top||.5,p=a.left||.5,q=a.closable||!1,r=$.isFunction(a.onClose)?a.onClose:function(){l("XDialog: XDialog is closed.")},s=$.isFunction(a.onOpen)?a.onOpen:function(){l("XDialog: XDialog is opened.")},t=!1,u=a.id||"XDialog-"+k.guid(),v=a.className||"",w=a.title||"XDialog",x=a.zIndex||1e3,y=a.draggable||!1,z=a.animated||!1,A=a.content||"",B=!0,C=!1,D=!1,E={};return"autoOpen"in a&&a.autoOpen===!0&&(t=!0),d=$("<div class='XDialog' id='"+u+"'><div class='XDialogTitle'><span class='titleText'></span><span class='closeBtn'></span></div><div class='XDialogContent'></div></div>")[0],e=$(d).find(".XDialogContent")[0],f=$(d).find(".closeBtn")[0],g=$(d).find(".titleText")[0],$(document.body).append(d).css("position","relative"),$(f).click(function(a){a.stopPropagation(),E.close()}),E.domNode=d,E.contentNode=e,E.closeBtn=f,E.init=function(){return $(d).css("position","fixed").css("top",o).css("left",p).css("z-index",x).hide().addClass(v),$(e).css("min-width","200px").css("min-height","200px").css("height",n).css("width",m).html(A),$(d).find(".closeBtn").hide(),b=$(d).outerWidth(),c=$(d).outerHeight(),$(d).css("margin-top",-c/2).css("margin-left",-b/2),$(d).find(".titleText").html(w),t&&E.open(),q&&$(d).find(".closeBtn").show(),y&&($(g).css("cursor","move"),$(g).on("mousedown."+u,function(a){1===a.which&&(D=!0,h=a.pageX,i=a.pageY)}),$(document).on("mousemove."+u,function(a){var b,c,e,f;D&&(g.onselectstart=function(){return!1},b=a.pageX,c=a.pageY,e=b-h,f=c-i,o+=+f,p+=e,$(d).css("top",o).css("left",p),h=b,i=c)}),$(document).on("mouseup."+u,function(){D=!1,g.onselectstart=function(){return!0}})),E},E.set=function(a){return"width"in a&&(m=a.width),"height"in a&&(n=a.height),"top"in a&&(o=a.top),"left"in a&&(p=a.left),"title"in a&&(w=a.title),"className"in a&&(v=a.className),"closable"in a&&(q=Boolean(a.closable)),"onClose"in a&&$.isFunction(a.onClose)&&(r=a.onClose),"onOpen"in a&&$.isFunction(a.onOpen)&&(s=a.onOpen),"autoOpen"in a&&(t=Boolean(a.autoOpen)),"zIndex"in a&&$.isNumeric(a.zIndex)&&(x=a.zIndex),"draggable"in a&&(y=a.draggable),"animated"in a&&(z=Boolean(a.animated)),"content"in a&&(A=a.content.toString()),E},E.open=function(){return C||(z?$(d).fadeIn("fast"):$(d).show(),C=!0,j=k.addShield(document.body,.5,x-1),s(),B&&(o=$(window).height()*o-$(d).outerHeight()/2,p=$(window).width()*p-$(d).outerWidth()/2,$(d).css("top",o).css("left",p).css("margin-top",0).css("margin-left",0),B=!1)),E},E.close=function(){return C&&(z?$(d).fadeOut("fast"):$(d).hide(),C=!1,k.removeShield(),r()),E},E.init(),E},XUtil.Class=function(a){function b(){this.init.apply(this,arguments),b.instances[XUtil.helpers.guid()]=this}var c;return b.instances={},b.find=function(a){return a&&b.instances[a]?b.instances[a]:void 0},a&&(c=function(){},c.prototype=a.prototype,b.prototype=new c,b.parent=a,b.parentProto=a.prototype,b.parentInit=a.prototype.init),b.prototype.init=function(){},b.prototype.constructor=Object,b.include=function(a){var c;for(c in a)a.hasOwnProperty(c)&&(b.prototype[c]=a[c])},b.extend=function(a){var c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c])},b},XUtil.loader={option:{root:"",isSync:!0},config:function(a){var b=this.option;for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])},load:function(){var files,arg=arguments[0],callback=arguments[1]||function(){console.log("all loaded")},root=this.option.root?this.option.root.replace(/\/$/,"")+"/":"",rjs=/.js/,count=0,lock=!1;files=arg;for(var i=0;i<files.length;i++){var file=files[i],isAbsoluteUrl;file="object"==typeof file?file:{path:file},isAbsoluteUrl=/^(?:http:\/\/|\/)/.test(file.path);var script,src,xhrSync,scriptText,link,href,rel,head=document.head;if(rjs.test(file.path))if(src=isAbsoluteUrl?file.path:root+file.path,script=document.createElement("script"),this.option.isSync){if(xhrSync=new XMLHttpRequest,xhrSync.open("GET",src,!1),xhrSync.send(),200!==xhrSync.status)throw new Error(request.statusText);scriptText=xhrSync.responseText,eval(scriptText),head.appendChild(script),script.type="text",script.text=scriptText,script.src=src,script.type="text/javascript"}else{script.src=src,count++,script.onload=function(){lock||0===--count&&(lock=!0,callback())};for(var attrJs in file)file.hasOwnProperty(attrJs)&&"path"!==attrJs&&script.setAttribute(attrJs,file[attrJs]);head.appendChild(script)}else{link=document.createElement("link"),href=isAbsoluteUrl?file.path:root+file.path,rel=file.rel||"stylesheet",link.href=href,link.rel=rel;for(var attrCss in file)file.hasOwnProperty(attrCss)&&"path"!==attrCss&&link.setAttribute(attrCss,file[attrCss]);head.appendChild(link)}}console.log("all done!")}},XUtil.XMenu=function(a){var b=XUtil.helpers.log,c=a.id||"XMenu-"+XUtil.helpers.guid(),d=a.renderTo,e=a.menuClass||"",f=a.textClass||"",g=a.iconClass||"",h=a.labelClass||"",i=a.iconRightClass||"",j=a.subMenuMargin||20,k=[],l=[],m=[],n=function(a,c){var d=a.id||"XMenu-SimpleItem-"+XUtil.helpers.guid(),e=$("<li class='XMenuItem XMenuSimpleItem' id='"+d+"'></li>"),j=$("<div class='XMenuItemIcon' style='display:inline-block;'></div>"),l=$("<div class='XMenuItemLabelText' style='display:inline-block;'></div>"),m=$("<div class='XMenuItemLabel simpleItemLabel'></div>"),n=$("<div class='XMenuItemIconRight' style='display:inline-block;'></div>"),o=a.label,p=a.onClick||function(a){b(a)},r=a.iconClass||g,s=a.iconRightClass||i,t=a.textClass||f,u=a.labelClass||h;k.push(a),a.domNode=e,e.data("itemData",a.itemData),m.append(j).append(l).append(n).appendTo(e),l.html(o).addClass(t),j.addClass(r),n.addClass(s),m.addClass(u),e.click(function(){p(a.data,a,e)}),"horizontal"===q.type&&e.bind("mouseenter",function(){var b;b=a.parent.subMenu?a.parent.subMenu:a.parent.menuSrc,b.forEach(function(a){a.close&&a.close()})}),$(c).append(e)},o=function(a,c){var d,k=a.label,m=a.id||"XMenu-PopupItem-"+XUtil.helpers.guid(),p=$("<div class='XMenuItem XMenuPopupItem' id='"+m+"'></div>"),r=$("<ul class='XMenuSubMenu'></ul>"),s=$("<li class='XMenuItemLabel popupItemLabel' style='cursor:pointer;'></li>"),t=$("<div class='XMenuItemIcon' style='display:inline-block;'></div>"),u=$("<div class='XMenuItemLabelText' style='display:inline-block;'></div>"),v=$("<div class='XMenuItemIconRight' style='display:inline-block;'></div>"),w=a.textClass||f,x=a.iconClass||g,y=a.labelClass||h,z=a.subMenuClass||e,A=a.iconRightClass||i,B=a.onClick||function(a){b(a)};l.push(a),a.domNode=p,p.data("itemData",a.data),$(c).append(p),r.hide(),"horizontal"===q.type&&r.css("position","absolute"),r.addClass(z),u.html(k).addClass(w),t.addClass(x),v.addClass(A),s.addClass(y),s.append(t).append(u).append(v).appendTo(p),u.click(function(){B(a.data,a,p)}),d=a.subMenu,d.forEach(function(b){var c=b.itemClass;b.parent=a,"simple"===c?n(b,r):"popup"===c&&o(b,r)}),r.appendTo(p);var C=function(){var b,c,d,e,f,g=q.openDirection;b=parseInt(p.css("width")),c=isNaN(parseInt(r.css("border-left-width")))?0:parseInt(r.css("border-left-width")),d=isNaN(parseInt(r.css("border-top-width")))?0:parseInt(r.css("border-top-width")),"vertical"===q.type?(q.animated===!0?r.slideDown("fast"):r.show(),r.css("margin-left",j).css("width",b-j-2*c)):("bottomRight"===g?(e=s.parent().parent().outerWidth()+s.parent().position().left,f=s.position().top,r.css("top",f-d+"px").css("left",parseInt(e-2*c)+"px")):"bottomLeft"===g?(e=s.parent().position().left-s.parent().parent().outerWidth(),f=s.position().top,r.css("top",f-d+"px").css("left",parseInt(e)+"px")):"topRight"===g?(e=s.parent().parent().outerWidth()+s.parent().position().left,f=s.position().top-r.outerHeight()+s.outerHeight(),r.css("top",f+d+"px").css("left",parseInt(e-2*c)+"px")):"topLeft"===g&&(e=s.parent().position().left-s.parent().parent().outerWidth(),f=s.position().top-r.outerHeight()+s.outerHeight(),r.css("top",f+d+"px").css("left",parseInt(e)+"px")),q.animated===!0&&"horizontal"===q.type?r.fadeIn("fast"):r.show()),s.find(".XMenuItemIconRight").addClass("rotate"),s.addClass("opened"),s.attr("opened","opened"),v.addClass("subExpanded"),a.isOpened=!0},D=function(){var a=this.domNode.find(".XMenuSubMenu"),b=this.domNode.find(".XMenuItemLabel"),c=this.domNode.find(".XMenuItemIconRight");a.find(".XMenuPopupItem").removeAttr("opened"),c.removeClass("rotate"),q.animated===!0&&"vertical"===q.type?a.slideUp("fast"):q.animated===!0&&"horizontal"===q.type?a.fadeOut("fast"):a.hide(),this.subMenu.forEach(function(a){"popupItem"===a.itemClass&&$.proxy(D,a)()}),b.removeClass("opened"),b.attr("opened")&&b.removeAttr("opened"),c.removeClass("subExpanded"),this.isOpened=!1};a.open=C,a.close=D,a.isOpened=!1,"vertical"===q.type?v.click(function(){var b=$(this.parentNode).attr("opened");"opened"===b?a.close():a.open()}):p.bind("mouseenter",function(){var b,c,d=this;c=a.parent.subMenu?a.parent.subMenu:a.parent.menuSrc,$(d).find(".XMenuItemLabel").attr("opened","opened"),c.forEach(function(b){b!==a&&b.close&&b.close()}),setTimeout(function(){b=$(d).find(".XMenuItemLabel").attr("opened"),b&&a.open()},400)})},p=function(a){for(var b,c=[],d=a;void 0!==d.parent&&void 0!==d.parent.subMenu;)b=d.parent.subMenu.indexOf(d),c.push(b),d=d.parent;return c.push(d.parent.menuSrc.indexOf(d)),c.reverse().join("-")};$(document).click(function(a){var b=a.target;"horizontal"===q.type&&($(q.domNode).find(b)[0]||q.closeAll())}),$(document).bind("mousemove",function(a){var b,c,d,e=a.target;b=a.pageX,$(q.domNode).find(e)[0]||"horizontal"!==q.type||q.allItems.forEach(function(a){"popup"===a.itemClass&&a.isOpened===!0&&(c=a.domNode,d=$(c).offset().left,-1!==q.openDirection.toLowerCase().search("right")?d>b&&a.close():-1!==q.openDirection.toLowerCase().search("left")&&d+$(c).outerWidth()<b&&a.close())})});var q={};return q.type=a.type||"vertical",q.animated=!1,"animated"in a&&a.animated===!0&&(q.animated=!0),q.menuSrc=[],q.allItems=[],q.openDirection=a.openDirection||"bottomRight",q.maxLevel=0,q.append=function(a){return a&&a.itemClass&&("popup"===a.itemClass||"simple"===a.itemClass)&&(q.menuSrc.push(a),a.parent=q),q},q.open=function(a){var b,c,d=a.split("-"),e=q.menuSrc[d[0]];if(!e.open)return e;for(e.open(),b=1;b<d.length;b++)c=d[b],e.subMenu[c]&&e.subMenu[c].open&&e.subMenu[c].open(),e=e.subMenu[c];return e},q.closeAll=function(){return q.menuSrc.forEach(function(a){"popup"===a.itemClass&&a.close()}),q},q.init=function(){var a=$("<div class='XMenu' id='"+c+"'></div>")[0],b=$(d)[0];if($(d).length>1)throw error("XMenu: option.renderTo属性设置有误！");return $(a).addClass(e).css("position","relative"),$(b).empty().append(a),q.menuSrc.forEach(function(b){var c=b.itemClass;b.parent=q,"simple"===c?n(b,a):"popup"===c&&o(b,a)}),m=k.concat(l),m.forEach(function(a){var b;a.location=p(a),a.rootMenu=q,b=a.location.split("-").length,b>q.maxLevel&&(q.maxLevel=b)}),q.domNode=a,q.allItems=m,$(a).children().addClass("firstLevelItem"),$(a).addClass("vertical"===q.type?"vertical":"horizontal"),q},q},XUtil.MenuItem=function(a){return{itemClass:"simple",label:a.label||"空",onClick:a.onClick||function(a){var b=XUtil.helpers.log;b(a)},option:a,iconClass:a.iconClass||"",labelClass:a.labelClass||"",id:a.id||"XMenu-SimpleItem-"+XUtil.helpers.guid(),textClass:a.textClass||"",iconRightClass:a.iconRightClass||"",data:a.data||{},parent:void 0,remove:function(){var a;return this.parent.subMenu?(a=this.parent.subMenu.indexOf(this),-1!==a&&this.parent.subMenu.splice(a,1)):this.parent.menuSrc&&(a=this.parent.menuSrc.indexOf(this),-1!==a&&this.parent.menuSrc.splice(this.parent.menuSrc.indexOf(this),1)),this.rootMenu&&this.rootMenu.init&&this.rootMenu.init(),this},appendTo:function(a){return void 0===a||void 0===a.parent?this:this.parent===a?this:(this.remove(),a.append?a.append(this):(a.itemClass="popup",a.subMenu=[],a.subMenuClass="",a.append=function(a){return a&&a.itemClass&&("popup"===a.itemClass||"simple"===a.itemClass)&&(this.subMenu.push(a),a.parent=this),this.rootMenu&&this.rootMenu.init&&this.rootMenu.init(),this},a.append(this)),this.rootMenu&&this.rootMenu.init&&this.rootMenu.init(),this)},insertAt:function(a){return this.remove(),this.parent.subMenu?this.parent.subMenu.splice(a,0,this):this.parent.menuSrc.splice(a,0,this),this.rootMenu&&this.rootMenu.init&&this.rootMenu.init(),this}}},XUtil.PopupMenuItem=function(a){var b=XUtil.MenuItem(a);return b.id=a.id||"XMenu-PopupItem-"+XUtil.helpers.guid(),b.itemClass="popup",b.subMenu=[],b.subMenuClass=a.subMenuClass||"",b.append=function(a){return a&&a.itemClass&&("popup"===a.itemClass||"simple"===a.itemClass)&&(b.subMenu.push(a),a.parent=b),b.rootMenu&&b.rootMenu.init&&b.rootMenu.init(),b},b.open=function(){},b.close=function(){},b},XUtil.XSuspendedMenu=function(a){var b,c=XUtil.helpers.error,d="XSuspendedMenuContainer-"+XUtil.helpers.guid(),e=a.bindTo||"mouse",f=a.offset||{top:0,left:0},g=a.animated||!1;b=g?!0:!1;var h=$("<div class='XSuspendedMenuContainer'></div>"),i={};if(h.css("position","absolute").attr("id",d).attr("opened","false").appendTo(document.body).hide(),a.renderTo="#"+d,a.animated=b,a.type="horizontal",i.menu=XUtil.XMenu(a),i.menu.init(),i.container=h,i.bindToDom=void 0,i.isOpened=!1,i.target=void 0,!$(e)[0])throw c("XSuspendedMenu: 目标dom不存在，请检查option.bindTo属性.");return i.bindToDom=$(e),i.show=function(a,b){var c,d,e,j,k;return c=$(document).outerWidth()-i.menu.maxLevel*h.outerWidth(),d=$(document).outerHeight()-i.menu.maxLevel*h.outerHeight(),c>a?(h.css("left",a+3+f.left),e="Right"):(h.css("left",a-h.outerWidth()-3+f.left),e="Left"),d>b?(h.css("top",b+3+f.top),j="bottom"):(h.css("top",b-h.outerHeight()-3+f.top),j="top"),k=j+e,i.menu.openDirection=k,i.menu.init(),g?h.fadeIn(150):h.show(),h.attr("opened","true"),i.isOpened=!0,i},i.init=i.menu.init,i.hide=function(){return g?h.fadeOut(150):h.hide(),h.attr("opened","false"),i.target=void 0,i.isOpened=!1,i},$(i.bindToDom).bind("contextmenu",function(a){var b=a.pageX,c=a.pageY;a.preventDefault(),a.stopPropagation(),i.isOpened?(i.hide(),i.target=a.currentTarget,setTimeout(function(){i.show(b,c)},150)):i.show(b,c)}),$(document.body).bind("click",function(a){var b=a.target;0!==a.button||h.find(b)[0]||"true"!==h.attr("opened")||i.hide()}),i},XUtil.XPopout=function(a){var b=XUtil.helpers.error,c={},d=a.renderTo,e=a.id||"XPopout-"+XUtil.helpers.guid(),f=a.width||"auto",g=a.height||"auto",h=a.animation||"default",i=a.position||"lowerLeft",j=$(d)[0],k=!1,l=a.className||"",m=a.content||"",n=a.triggerBy||"click",o=a.offset||{top:0,left:0},p=a.onOpen||function(){},q=a.onClose||function(){},r=$("<div class='xPopout' id='"+e+"'></div>");if(void 0!==a.autoOpen&&a.autoOpen===!0&&(k=!0),void 0===j)throw b("XPopout: 配置参数有误，请检查option.renderTo属性");return"slide"!==h||"upperLeft"!==i&&"upperRight"!==i||(h="default"),r.append(m).addClass(l),r.appendTo(document.body),r.css("position","absolute").css("height",g||"auto").css("width",f||"auto").css("display","none").css("background-color","#fff").css("padding","10px"),c.bindDom=j,c.popout=r[0],c.setPosition=function(a){var b=$(j).offset(),d=j.offsetWidth,e=j.offsetHeight,f={top:b.top+e+Number(o.top),left:b.left+o.left},g={top:b.top+e+Number(o.top),left:b.left+d-r.outerWidth()+Number(o.left)},h={top:b.top-r.outerHeight()+Number(o.top),left:b.left+Number(o.left)},i={top:b.top-r.outerHeight()+Number(o.top),left:b.left+d-r.outerWidth()+Number(o.left)},k=function(a){r.css("top",a.top),r.css("left",a.left)};return"lowerLeft"===a?(k(f),c.position=a):"lowerRight"===a?(k(g),c.position=a):"upperLeft"===a?(k(h),c.position=a):"upperRight"===a?(k(i),c.position=a):(k(f),c.position="lowerLeft"),c},c.open=function(){return"closed"===c.status&&(p(r[0]),c.setPosition(i),"fade"===h?r.fadeIn("fast"):"slide"!==h||"lowerLeft"!==i&&"lowerRight"!==i?r.show():r.slideDown("fast"),c.status="opened"),c},c.close=function(){return"opened"===c.status&&(q(r[0]),"fade"===h?r.fadeOut("fast"):"slide"!==h||"lowerLeft"!==i&&"lowerRight"!==i?r.hide():r.slideUp("fast"),c.status="closed"),c},c.setPosition(i),k===!1?c.status="closed":(c.status="opened",c.open()),function(){var a=!1,b=function(b,d){var e;b.stopPropagation(),e=b.target,0!==r.children().length&&e!==r[0]&&e!==j&&void 0===r.find(e)[0]||0===r.children().length&&e!==j&&e!==r[0]?(a=!1,"hover"!==n||d?c.close():setTimeout(function(){a||"opened"!==c.status||c.close()},400)):a=!0};"hover"===n?($(j).on("mouseenter.XPopoutOpen",function(){a=!0,setTimeout(function(){a&&c.open()},350)}),$(document).on("mouseover.XPopoutClose",function(a){b.call(this,a)}),$(document).on("click.XPopoutClose",function(a){b.call(this,a,!0)})):($(j).on("click.XPopoutOpen",function(){c.open()}),$(document).on("click.XPopoutClose",function(a){b.call(this,a)}))}(),c},XUtil.XTable=function(a){var b=XUtil.helpers.log,c=XUtil.helpers.error,d={},e=a.id||"XTable-"+XUtil.helpers.guid();if(!a.src)throw c("XTable: 配置参数有误，请检查src属性是否为合法的JSON数据");var f=XUtil.config.rootPath;if(!f||""===f)throw c("XTable: 配置参数有误，请检查myUtil.config对象");var g=!0;"colEditable"in a&&a.colEditable===!1&&(g=!1);var h=!0;"hasFilter"in a&&a.hasFilter===!1&&(h=!1);var i=a.filterType||1,j=$(a.renderTo)[0];if(!j||$(a.renderTo).length>1)throw c("XTable: 配置参数有误，请检查option.renderTo属性");var k=a.fontSize||"14px";$(j).empty().css("font-size",k);var l=[],m=[],n=[],o=[],p=[],q=[];a.columns.forEach(function(a){if(l.push(a.name),h===!0?"hasFilter"in a&&a.hasFilter!==!0?"hasFilter"in a&&a.hasFilter===!1&&p.push(!1):p.push(!0):p.push(!1),"sortable"in a&&a.sortable!==!0?"sortable"in a&&a.sortable===!1&&q.push(!1):q.push(!0),!("data"in a))throw c("XTable.js: 配置参数有误，请检查option.column的data属性。");m.push(a.data),n.push(a.width),"visible"in a&&a.visible!==!0||o.push(a.data)});var r=!0,s=[],t=a.beforeSelect||function(){},u=a.selectCb||function(){},v=a.beforeDeselect||function(){},w=a.deselectCb||function(){};"selectable"in a&&a.selectable===!1&&(r=!1);var x,y=a.beforeDelete||function(){return!0},z=a.deleteCb||function(){};x="deletable"in a&&a.deletable===!0?!0:!1;var A=a.editable||!1,B=a.showEditCol||!1,C=[],D=0,E=A&&a.editCb||function(){},F=A&&a.beforeEdit||function(){},G="top";"controllerPosition"in a&&"bottom"===a.controllerPosition&&(G="bottom");var H=a.pageSizes||[10,20,50,100,200],I=parseInt(H[0]),J=a.linkCols,K=[],L=$("<div class='xTable-table'></div>"),M=$("<div class='xTable-controller'></div>"),N=$("<div class='xTable-pageController'></div>"),O=$("<div class='xTable-pageSizeController'></div>"),P=$("<li class='functionButton prevButton ui-state-default ui-corner-all'><span class='ui-icon ui-icon-seek-prev'></span></li>"),Q=$("<li class='functionButton nextButton ui-state-default ui-corner-all'><span class='ui-icon ui-icon-seek-next'></span></li>"),R=$("<li class='functionButton firstButton ui-state-default ui-corner-all'><span class='ui-icon ui-icon-seek-first'></span></li>"),S=$("<li class='functionButton lastButton ui-state-default ui-corner-all'><span class='ui-icon ui-icon-seek-end'></span></li>"),T=$("<input type='text' class='xTable-gotoBox' value='1'/>"),U=$("<span class='xTable-maxPage'></span>"),V=$("<table class='xTable-view' border='1' width='100%'></table>"),W=$("<select class='xTable-pageSizeSelector'></select>");H.forEach(function(a){W.append("<option value='"+a+"'>"+a+"</option>")}),N.append(R).append(P).append(T).append(U).append(Q).append(S),M.append(N).append(O),"top"===G?L.append(M).append(V):L.append(V).append(M),$(j).append(L);var X=$("<input class='xTable-selectAll' type='checkbox'/>"),Y=$("<td class='xTable-selectAllTd' class='xTable-selectAllTd'></td>");Y.append(X),V.empty();var Z=[],_=$("<tr class='xTable-Header'></tr>");if(r&&_.append(Y),l.forEach(function(a,b){var c=$("<td class='colName' colName='"+a+"'><div class='colNameText'>"+a+"</div></td>");if(_.append(c),Z.push(c),p[b]&&$("<li class='openFilterLi ui-state-default ui-corner-all' title='.ui-icon-search'><span class='ui-icon ui-icon-search'></span></li>").appendTo(c),q[b]){var d=$("<div class='orderTag'></div>");c.attr("sortable","true").append(d)}else c.attr("sortable","false")}),A){var aa=$("<td class='editHeader' colName='edit'>编辑</td>");_.append(aa),B||aa.hide()}n.forEach(function(a,b){Z[b]&&Z[b].css("width",a)}),m.forEach(function(a,b){Z[b]&&Z[b].attr("srcName",a)}),V.append(_),$(j).find("li").hover(function(){$(this).addClass("ui-state-hover"),$(this).css("cursor","pointer")},function(){$(this).removeClass("ui-state-hover"),$(this).css("cursor","default")}),$("#"+e+"-setVCols",L).remove();var ba=$("<div id='"+e+"-setVCols'></div>");ba.dialog({autoOpen:!1,width:400,resizable:!1,title:"设置显示的列",buttons:[{text:"确定",id:e+"-submitVCols",click:function(){}},{text:"取消",id:e+"-closeSetVCols",click:function(){$(this).dialog("close")}}],position:{my:"top+10%",at:"top+10%",of:window},open:function(){XUtil.helpers.addShield(document.body)},close:function(){XUtil.helpers.removeShield()}}),$(L).append(ba.parent());var ca=$("<input type='button' value='设置' class='openSetV'/>");g&&(ca.insertAfter(S),ca.button());var da=$("<input type='checkbox' class='showAllCol' checked='true'/>"),ea=$("<div class='subVCol showAllColSpan'></div>");ea.append(da).append("全部").appendTo(ba),a.columns.forEach(function(a){var b=$("<div class='subVCol'></div>"),c=$("<input type='checkbox' class='vColCb' srcName='"+a.data+"' colName='"+a.name+"'/>");b.append(c).append(a.name),"visible"in a&&a.visible!==!0?(c.prop("checked",!1),da.prop("checked",!1)):c.prop("checked",!0),ba.append(b)});var fa=$("<input type='button' value='全选当前页' class='funcButton'/>");r&&(fa.appendTo(N),fa.button());var ga;x&&(ga=$("<input type='button' value='剔除选中条目' class='funcButton deleteBtn'/>").button({disabled:!0}),ga.appendTo(N));var ha=function(a,b,c,e,f){a=parseInt(a);var g,h;!isNaN(a)&&a>=0&&a<l.length&&(g=$(".dataTr",L).toArray(),h=[],g.forEach(function(b){$(b).find(".dataCell")[a]&&h.push($(b).find(".dataCell")[a])}),h.forEach(function(a,h){var i=parseInt($(g[h]).attr("srcindex")),j=d.orgSrc[i],k=$(a).text(),l=$("<a href=''>"+k+"</a>");"button"===f&&(l=$("<input type='button' value='"+k+"'>").button()),b&&"button"!==f?l.attr("href",b(i,j,l)):"button"!==f&&l.attr("href","javascript: void (0)"),c&&"button"===f?l.attr("target",c):l.attr("target","_blank"),b||l.attr("target","_self"),e&&l.click(function(){var a=this;e(j,a)}),$(a).attr("editInvalid","true"),$(a).empty().append(l)}))},ia=function(a){$(".dataTr",L).remove(),$(".tempMessage",L).remove(),$("<div class='tempMessage'>"+a+"</div>").insertAfter(L.find(".xTable-view")),XUtil.helpers.addShield(L)},ja=function(){$(L).find(".tempMessage").remove(),XUtil.helpers.removeShield()};return d.orgSrc=a.src,d.id=e,d.headers=Z,d.attrs=m,d.src=d.orgSrc.slice(),d.option=a,d.firstButton=R,d.prevButton=P,d.gotoBox=T,d.nextButton=Q,d.lastButton=S,d.pageSizeSelector=W,d.pageController=N,d.controller=M,d.view=V,d.src.forEach(function(a,b){a.selected=!1,a.orgIndex=b}),d.init=function(){var a,b,c,e=d.src,f=Math.ceil(e.length/I);for(K=[],s=[],O.empty().append("共"+e.length+"条结果，每页显示").append(W).append("条"),U.html(" / "+f),$(".xTable-selectAll",L).prop("checked",!1),a=0;a<e.length;a++)if(e[a].selected=!1,(a+1)%I===0){for(c=[],b=I;b>0;b--)e[a-b+1].srcIndex=a-b+1,c.push(e[a-b+1]);K.push(c)}else if(a===e.length-1){for(c=[],b=I*(f-1);b<e.length;b++)e[b].srcIndex=b,c.push(e[b]);K.push(c)}d.loadPage(1)},d.destroy=function(){$(j).empty()},d.loadPage=function(b){var d,e,f,g;return 0!==D?void alert("请先保存当前正在编辑的行！"):0===K.length?void $(".dataTr",L).remove():void(b>0&&b<=K.length&&($(".dataTr",L).remove(),T.val(b),b=parseInt(b),d=K[b-1],d.forEach(function(d,f){var g=$("<tr class='dataTr'></tr>"),h=$("<input type='checkbox' class='selectRow'/>"),i=$("<td class='rowCb'></td>");g.attr("index",I*(b-1)+f),r&&d.selected&&(h.prop("checked",!0),g.addClass("rowSelect")),g.attr("srcIndex",d.orgIndex).data("srcObj",d),i.append(h),r&&g.append(i),g.appendTo(V),m.forEach(function(b,e){var f=$("<td class='dataCell' srcName='"+b+"'></td>");if(!(b in d))throw c("XTable.js: 源JSON数据与data属性关联失败，请检查参数对象：column的data属性输入是否正确。");f.append(d[b]),f.appendTo(g),A&&"editable"in a.columns[e]&&a.columns[e].editable===!1&&f.attr("editInvalid","true")}),A&&(e=$("<td class='editTd'><input type='button' class='editBtn' value='编辑'/></td>"),e.find("input").button(),g.append(e),B||e.hide())}),J&&J.length>0&&J.forEach(function(a){ha(a.colIndex,a.renderer,a.target,a.onclick,a.type)}),f=$(".dataCell",L).toArray(),g=$(".colName",L).toArray(),f.forEach(function(a){var b=$(a).attr("srcName");-1===o.indexOf(b)&&$(a).hide()}),g.forEach(function(a){var b=$(a).attr("srcName");-1===o.indexOf(b)?$(a).hide():$(a).show()})))},d.selectRow=function(a){var c=parseInt($(a).attr("index"));t(d.getSelectedData(),a),$(a).attr("select","selected"),$(a).find("input[type=checkbox]").prop("checked",!0),-1===s.indexOf(c)&&(s.push(c),d.src[c].selected=!0,$(a).addClass("rowSelect")),u(d.getSelectedData(),a),s.length>0&&x&&0===D&&ga.button({disabled:!1}),b("XTable-Filter.selectRow: The rows been selected are "),b(d.getSelectedData())},d.unselectRow=function(a){var c=$(a).attr("index"),e=s.indexOf(parseInt(c));v(d.getSelectedData(),a),$(a).removeClass("rowSelect").removeClass("rowHover").removeClass("rowSelect").removeAttr("select"),$(a).find("input[type=checkbox]").prop("checked",!1),$(".xTable-selectAll",L).prop("checked",!1),-1!==e&&(s.splice(e,1),d.src[c].selected=!1),w(d.getSelectedData(),a),0===d.getSelectedData().length&&x&&ga.button({disabled:!0}),b("XTable-Filter.unselectRow: The rows been selected are "),b(d.getSelectedData())},d.selectAll=function(){var a;for(t(d.getSelectedData()),$(".xTable-selectAll",L).prop("checked",!0),$(".selectRow",L).prop("checked",!0),s=[],$(".dataTr",L).attr("select","selected").addClass("rowSelect"),a=0;a<d.src.length;a++)s.push(a),d.src[a].selected=!0;s.length>0&&x&&0===D&&ga.button({disabled:!1}),u(d.getSelectedData())},d.unselectAll=function(){var a;for(v(d.getSelectedData()),s=[],a=0;a<d.src.length;a++)d.src[a].selected=!1;$(".selectRow",L).prop("checked",!1),$(".xTable-selectAll",L).prop("checked",!1),$(".dataTr",L).removeAttr("select").removeClass("rowSelect").removeClass("rowHover"),0===d.getSelectedData().length&&x&&ga.button({disabled:!0}),w(d.getSelectedData())},d.setPageSize=function(a){var b,c,e=W[0].options,f=-1;if(0!==D)return void alert("请先保存当前正在编辑的行！");for(I=parseInt(a),$(".orderTag",L).empty(),b=0;b<e.length;b++)if(c=e[b],parseInt(c.value)===I){f=b;break}W[0].selectedIndex=f,d.init()},d.toFirstPage=function(){d.loadPage(1)},d.toLastPage=function(){d.loadPage(K.length)},d.toPrevPage=function(){var a=parseInt(T.val());a>1&&d.loadPage(a-1)},d.toNextPage=function(){var a=parseInt(T.val());a<K.length&&d.loadPage(a+1)},d.getSelectedData=function(){var a=[];return s.forEach(function(b){a.push(d.src[b])}),a},d.setVisibleCols=function(a){return 0!==D?void alert("请先保存当前正在编辑的行！"):(o=a,void d.init())},d.editRow=function(a){var b=$(a).find(".dataCell").toArray();b.forEach(function(a){var b;$(a).attr("editInvalid")||(b=$(a).html(),$(a).empty().append("<input class='editInput' type='text' value='"+b+"'/>"))}),$($(a).find(".editBtn")).val("保存"),
D++,$(".xTable-pageSizeSelector",L).prop("disabled",!0),$("input[type=button]:not(.editBtn)",L).button({disabled:!0})},d.saveRow=function(a){var c,e=$(a).find(".dataCell").toArray(),f=$(a).attr("srcindex"),g=$(a).attr("index"),h=d.orgSrc[g];return F(h,a),e.forEach(function(a){var b="",c=$(a).attr("srcname");$(a).attr("editInvalid")||(b=$($(a).find(".editInput")).val(),"number"==typeof targetAttr?isNaN(Number(b))?(d.src[g][c]=0/0,d.orgSrc[f][c]=0/0,$(a).html(0/0)):(d.src[g][c]=Number(b),d.orgSrc[f][c]=Number(b),$(a).html(b)):(d.src[g][c]=b,d.orgSrc[f][c]=b,$(a).html(b)))}),-1===C.indexOf(f)&&C.push(f),c=d.getEditedData(),b("XTable-Filter.saveEdit: The rows been edited are "),b(c),$($(a).find(".editBtn")).val("编辑"),D--,0===D&&($(".xTable-pageSizeSelector",L).prop("disabled",!1),$("input[type=button]:not(.editBtn,.deleteBtn)",L).button({disabled:!1}),0!==s.length&&ga.button({disabled:!1})),E(h,a),h},d.getEditedData=function(){var a=[];return C.forEach(function(b){d.orgSrc[b]&&a.push(d.orgSrc[b])}),a},d.sortBy=function(a,b){var c=new Worker(f+"/workers/XTableSort.js");return 0!==D?void alert("请先保存当前正在编辑的行！"):(ia("正在排序，请稍候..."),c.postMessage({src:d.src,name:a,order:b}),void(c.onmessage=function(a){ja(),d.src=a.data,d.init(),c.terminate()}))},d.deleteSelectedData=function(){var a,b=d.getSelectedData();return 0!==D?void alert("请先保存当前正在编辑的行！"):void(y(b,d.orgSrc)&&(ia("正在删除，请稍候..."),a=new Worker(f+"/workers/XTableDelete.js"),a.postMessage({selectedData:b,orgSrc:d.orgSrc}),a.onmessage=function(c){d.orgSrc=c.data,d.src=d.orgSrc.slice(),d.src.forEach(function(a,b){a.selected=!1,a.orgIndex=b}),ja(),$(M).find(".cFilterData").remove(),$(M).find(".resetData").remove(),$(ga).button({disabled:!0}),d.init(),a.terminate(),z(b,d.orgSrc)}))},d.extendFunction=function(a){var b=$("<input type='button' value='"+a.fName+"' class='funcButton'/>");return b.appendTo(d.pageController).button({disabled:a.disabled}).click(function(){$.proxy(a.handler,this)(d.getSelectedData(),d.orgSrc)}),a.className&&b.addClass(a.className),a.style&&(b[0].style=b[0].style+";"+a.style),b},d.addRow=function(a,b,c){void 0===a&&(a={}),b&&b(a,d.orgSrc),m.forEach(function(b){void 0===a[b]&&(a[b]="")}),a.selected=!1,a.orgIndex=d.orgSrc.length,d.src.push(a),d.orgSrc.push($.extend({},a,!0)),d.init(),d.toLastPage(),d.view.find(".dataTr").last().find(".editTd").find("input").click(),d.view.find(".dataTr").last().find("input[type=text]").first().focus(),c&&c(a,d.orgSrc)},d.filter=function(){var a=XUtil.XFilter({src:[],id:d.id+"-filter",filterType:i}),b=a.id,c=a.filterDiv,e=c.parent(),g="",h="",j=a.selectedNames;return e.css("width","auto").css("font-size","16px"),c.dialog({open:function(){XUtil.helpers.addShield(document.body)}}),e.appendTo(L),a.loadFilterOverride=function(b,c){a.src=[],h=c,d.src.forEach(function(b){a.src.push(b[c])}),a.loadFilter(b)},a.cFilterdata=function(){var a;return 0!==D?void alert("请先保存当前正在编辑的行！"):void(d.src.length!==d.orgSrc.length&&($(".orderTag",L).empty(),ia("正在过滤，请稍候..."),a=new Worker(f+"/workers/XTableCFilter.js"),a.postMessage({src:d.src,orgSrc:d.orgSrc}),a.onmessage=function(a){ja(),d.src=a.data,d.init()}))},a.filterData=function(){var e;j=a.selectedNames,ia("正在过滤，请稍候..."),c.dialog("close"),e=new Worker(f+"/workers/XTableFilterData.js"),e.postMessage({src:d.src,selectedNames:j,filterSrcName:h}),e.onmessage=function(a){var c,f;ja(),$("#"+b+"-cFilterData",L).remove(),d.src=a.data,d.init(),$("#"+b+"-resetData",L).remove(),d.src.length!==d.orgSrc.length&&(c=$("<input type='button' class='resetData' id='"+b+"-resetData' style=''value='重置过滤器'/>"),f=$("<input type='button' class='cFilterData' id='"+b+"-cFilterData' value='反向过滤'/>"),c.insertAfter(O),c.button(),f.insertAfter(c),f.button()),e.terminate()}},a.resetData=function(){XUtil.helpers.addShield(),d.src=d.orgSrc.slice(),$(".orderTag",L).empty(),$("#"+b+"-resetData",L).remove(),$("#"+b+"-cFilterData",L).remove(),$(".orderTag",L).empty(),XUtil.helpers.removeShield(),d.init()},$(".openFilterLi",L).click(function(b){var d,e,f=c.dialog("isOpen");return b.stopPropagation(),0!==D?void alert("请先保存当前正在编辑的行！"):void(f||(d=$(this).prev().html(),e=$(this.parentNode).attr("srcname"),a.loadFilterOverride(d,e)))}),$(L).undelegate("#"+b+"-resetData","click"),$(L).delegate("#"+b+"-resetData","click",function(){a.resetData()}),$(e).undelegate("#"+b+"-startFilter","click"),$(e).delegate("#"+b+"-startFilter","click",function(){a.filterData()}),$(L).undelegate("#"+b+"-cFilterData","click"),$(L).delegate("#"+b+"-cFilterData","click",function(){a.cFilterdata()}),$("#"+b+"-resetFilter",e).unbind().click(function(){$("#"+b+"-filterStr").val("请输入过滤关键字").select(),a.loadFilterOverride(g,h)}),a}(),fa.click(function(){var a=$(".dataTr",L).toArray();$(".selectRow",L).prop("checked",!0),a.forEach(function(a){$(a).attr("select")||d.selectRow(a)})}),R.click(function(){d.toFirstPage()}),P.click(function(){d.toPrevPage()}),T.keydown(function(a){var b;13===a.keyCode&&(b=parseInt(this.value),d.loadPage(b))}),Q.click(function(){d.toNextPage()}),S.click(function(){d.toLastPage()}),ca.click(function(){ba.dialog("open")}),x&&ga.click(function(){d.deleteSelectedData()}),$("#"+d.id+"-submitVCols",ba.parent()).click(function(){var a=$("#"+d.id+"-setVCols .vColCb",ba.parent()).toArray(),b=[];a.forEach(function(a){var c=$(a).is(":checked");c&&b.push($(a).attr("srcName"))}),d.setVisibleCols(b),$(ba).dialog("close")}),$(".showAllCol",ba.parent()).change(function(){var a=$("#"+d.id+"-setVCols .vColCb",ba.parent());$(this).is(":checked")?a.prop("checked",!0):a.prop("checked",!1)}),$("#"+d.id+"-setVCols .vColCb",ba.parent()).change(function(){$(".showAllCol",ba.parent()).is(":checked")&&($(this).is(":checked")||$(".showAllCol",ba.parent()).prop("checked",!1))}),$(L).undelegate(".xTable-pageSizeSelector","change"),$(L).delegate(".xTable-pageSizeSelector","change",function(){var a=this.options.selectedIndex;d.setPageSize(this.options[a].value)}),$(L).undelegate(".selectRow","change"),$(L).delegate(".selectRow","change",function(){var a=this.parentNode.parentNode;$(this).is(":checked")?d.selectRow(a):d.unselectRow(a)}),$(L).undelegate(".xTable-selectAll","change"),$(L).delegate(".xTable-selectAll","change",function(){$(this).is(":checked")?d.selectAll():d.unselectAll()}),$(L).undelegate(".dataTr","mouseover"),$(L).delegate(".dataTr","mouseover",function(){var a=$(this).attr("select");a||$(this).addClass("rowHover")}),$(L).undelegate(".dataTr","mouseout"),$(L).delegate(".dataTr","mouseout",function(){var a=$(this).attr("select");a||$(this).removeClass("rowHover")}),$(L).undelegate(".colName","click"),$(L).delegate(".colName","click",function(){var a=$(this).attr("srcname"),b=$(this).attr("sortable");if("true"===b){if(0!==D)return void alert("请先保存当前正在编辑的行！");$(this).attr("order")&&"desc"!==$(this).attr("order")?($(this).attr("order","desc"),$(L).find(".orderTag").empty(),$(this).find(".orderTag").append("<img src='"+f+"/images/sort_desc.gif'>"),d.sortBy(a,"desc")):($(this).attr("order","asc"),$(L).find(".orderTag").empty(),$(this).find(".orderTag").append("<img src='"+f+"/images/sort_asc.gif'/>"),d.sortBy(a,"asc"))}}),$(L).undelegate(".editBtn","click"),$(L).delegate(".editBtn","click",function(){var a=this.parentNode.parentNode,b=$(this).val();"编辑"===b?d.editRow(a):d.saveRow(a)}),$(L).undelegate(".editInput","focus"),$(L).delegate(".editInput","focus",function(){var a=this;setTimeout(function(){a.select()},200)}),$(L).undelegate(".dataCell","dblclick"),$(L).delegate(".dataCell","dblclick",function(){var a,b;A&&!$(this).attr("editInvalid")&&(a=this.parentNode,b=$($(a).find(".editBtn")).val(),"编辑"===b&&d.editRow(a),$(this).find("input").focus())}),$(L).undelegate(".editInput","keydown"),$(L).delegate(".editInput","keydown",function(a){var b;13===a.keyCode&&(b=$(this.parentNode.parentNode).find(".editBtn"),"保存"===$(b).val()&&$(b).click())}),d.init(),d},XUtil.XFilter=function(a){var b=XUtil.helpers.log,c=XUtil.helpers.error,d={},e=a.id||"XFilter-"+XUtil.helpers.guid(),f=a.startFilterText||"确定",g=a.closeFilterText||"取消",h=a.startFilterHandler||function(a,b){b.filterDiv.dialog("close")},i=a.closeFilterHandler||function(a,b){b.filterDiv.dialog("close")},j=a.filterType||2,k=a.title||"",l=XUtil.config.rootPath,m=$("<div style='display:table' title='过滤器'></div>");$(m).attr("id",e),m.dialog({autoOpen:!1,resizable:!1,title:k,buttons:[{text:f,id:e+"-startFilter",click:function(){h(d.selectedNames,d)}},{text:g,id:e+"-closeFilter",click:function(){i(d.selectedNames,d)}}],position:{my:"top+10%",at:"top+10%",of:window},close:function(){XUtil.helpers.removeShield(),m.removeData("allNamesCatch"),m.removeData("sNamesCatch")},open:function(){XUtil.helpers.addShield(),m.removeData("allNamesCatch"),m.removeData("sNamesCatch")}});var n=m.parent(),o=$("<div class='xFilter-searchDiv'><div><input type='text' value='请输入过滤关键字' class='xFilter-filterStr' id='"+e+"-filterStr'/></div><div><input type='button' class='XFilter-searchBtn' value='搜索' id='"+e+"-filterSubmit'/></div><div><input type='button' class='XFilter-resetBtn' value='重置' id='"+e+"-resetFilter'/></div></div>"),p=$("<input type='radio' value='completeMatch' id='completeMatch' name='matchType'/>"),q=$("<input type='radio' value='partialMatch' id='partialMatch' checked='checked' name='matchType'/>"),r="partial",s=$("<div class='matchRadios'></div>"),t=$("<div></div>").append(p).append("<span class='xFilter-radioSpan'>完全匹配</span>"),u=$("<div></div>").append(q).append("<span class='xFilter-radioSpan'>部分匹配</span>"),v=$("<div class='xFilter-filterResult' id='xFilter-filterResult'></div>");if(s.append(u).append(t),o.append(s),m.append(o).append(v),!l||""===l)throw c("XFilter: 配置参数有误，请检查myUtil.config对象中的root属性");if(!a.src)throw c("XFilter: 配置参数有误，请检查option对象的src属性");return d.option=a,d.src=a.src,d.allNames=[],d.selectedNames=[],d.tempAllNames=[],d.id=a.id||"XFilter-"+XUtil.helpers.guid(),d.filterType=j,d.matchType=r,d.filterDiv=m,d.filterResult=v,d.startFilterBtn=$("#"+e+"-startFilter",n)[0],d.closeFilterBtn=$("#"+e+"-closeFilter",n)[0],d.completeMatch=p,d.partialMatch=q,d.loadFilter=function(a){var c,f,g,h=m.data("allNamesCatch"),i=m.data("sNamesCatch");a&&m.dialog({title:a}),m.dialog("open"),n.css("width","auto"),$("input[type=button]",m).button(),$("#"+e+"-filterStr",n).val("请输入过滤关键字").select(),q.prop("checked",!0),p.prop("checked",!1),m.find(".XFilter-matchResult").remove(),$(v).empty().append("正在加载关键字，请稍候..."),$("#"+e+"-startFilter").button({disabled:!0}),d.tempAllNames=[],h&&i?(b("XFilter.loadFilter: 从缓存加载关键字."),g=$("<div id='xFilter-fSelectAllSpan'><input type='checkbox' class='"+e+"-fselectAll' checked='checked' id='"+e+"-fselectAll'><span class='xFilter-nameTag'>全部</span></div>"),v.empty().append(g),$("#"+e+"-startFilter",n).button({disabled:!1}),d.allNames=h,d.selectedNames=i,d.allNames.forEach(function(a,b){var c;1e3>b&&(c=$("<div class='nameCell'><input type='checkbox' class='"+e+"-nameCb' key='"+a+"' checked='checked'/><span class='xFilter-nameTag'>"+a+"</span></div>"),v.append(c))})):(b("XFilter.loadFilter: 未找到缓存，将直接加载关键字."),c=new Worker(l+"/workers/XFilterGetKeys.js"),f={src:d.src},c.postMessage(f),c.onmessage=function(a){var b=a.data,f=b.names,h=b.sNames;g=$("<div id='xFilter-fSelectAllSpan'><input type='checkbox' class='"+e+"-fselectAll' checked='checked' id='"+e+"-fselectAll'><span class='xFilter-nameTag'>全部</span></div>"),$("#"+e+"-startFilter",n).button({disabled:!1}),v.empty().append(g),d.allNames=f,d.selectedNames=h,f.forEach(function(a,b){var c;1e3>b&&(c=$("<div class='nameCell'><input type='checkbox' class='"+e+"-nameCb' key='"+a+"' checked='checked'><span class='xFilter-nameTag'>"+a+"</span></div>"),v.append(c))}),m.data("allNamesCatch",d.allNames),m.data("sNamesCatch",d.selectedNames),c.terminate()})},d.selectName=function(a){-1===d.selectedNames.indexOf(a)&&d.selectedNames.push(a)},d.unselectName=function(a){var b=d.selectedNames.indexOf(a);-1!==b&&d.selectedNames.splice(b,1),$("#"+e+"fselectAll",n).prop("checked",!1)},d.searchByName=function(a,c){var f,g,h,i,k,l,m,n,o,q,r=[],t=d.allNames,u=[],v=d.filterResult,w="",x=a.split(/\s+/),y=$("<div id='tSelectAll'><input type='checkbox' checked='checked' class='"+e+"-fselectAll' id='"+e+"-fselectAll'><span class='xFilter-nameTag'>全部</span></div>");for(c?w=c:(w="partial",$(p).is(":checked")&&(w="complete")),a=a.replace(/[\u3002\uff1b\uff0c\uff1a\u201c\u201d\uff08\uff09\u3001\uff1f\u300a\u300b]|\s|\,|\.|\?/g," ").trim().toLowerCase(),f=0;f<x.length;f++)if(i=x[f].trim(),""!==i)for(g=0;g<t.length;g++){if(k=t[g].toString(),l=t[g].toString().toLowerCase(),m=!0,"partial"===w)if(1===parseInt(j))if(isNaN(Number(i))){for(h=0;h<i.length;h++)if(-1===l.search(i.charAt(h))){m=!1;break}if(m){var z=[];for(h=0;h<i.length;h++)if(-1!==l.search(i.charAt(h)))if(n=l.indexOf(i.charAt(h)),o=l.lastIndexOf(i.charAt(h)),0===z.length)z.push(n);else{if(o<z[z.length-1]){m=!1;break}z.push(n>z[z.length-1]?n:o)}}}else isNaN(i)||isNaN(parseInt(l))?!isNaN(i)&&isNaN(parseInt(l))&&(m=!0,-1===l.toString().search(""+i)&&(m=!1)):(m=!1,0===l.toString().search(""+i)&&(m=!0));else m=!1,-1!==l.search(i)&&(m=!0);else m=!1,l===i&&(m=!0);m&&(-1===r.indexOf(k)&&r.push(k),-1===u.indexOf(k)&&u.push(k))}for(v.empty().append(y),f=0;f<u.length&&500>f;f++)l=u[f],q=$("<div class='nameCell'><input type='checkbox' checked='checked' class='"+e+"-nameCb' key='"+l+"' index='"+f+"'><span class='xFilter-nameTag'>"+l+"</span></div>"),v.append(q);s.find(".XFilter-matchResult").remove(),s.append("<span class='XFilter-matchResult'>共匹配到<span class='red'>"+u.length+"</span>条关键字</span>"),d.selectedNames=r,d.tempAllNames=u,b(d.selectedNames)},d.fSelectAll=function(){d.selectedNames=[],0===d.tempAllNames.length?d.allNames.forEach(function(a){d.selectedNames.push(a)}):d.tempAllNames.forEach(function(a){d.selectedNames.push(a)})},d.fUnselectAll=function(){d.selectedNames=[]},$("#"+e+"-filterStr",n).unbind().focus(function(){var a=this;setTimeout(function(){a.select()},200)}),$("#"+e+"-filterStr",n).keydown(function(a){13===a.keyCode&&$("#"+e+"-filterSubmit",n).click()}),$("#"+e+"-filterSubmit",n).unbind().click(function(){var a,b=$("#"+e+"-filterStr",n).val();""!==b&&"请输入过滤关键字"!==b?(a="partial",$(p).is(":checked")&&(a="complete"),d.searchByName(b,a)):$("#"+e+"-resetFilter",n).click()}),$(n).undelegate("."+e+"-nameCb","change"),$(n).delegate("."+e+"-nameCb","change",function(){var a=$(this).is(":checked"),b=$(this).attr("key");a?d.selectName(b):(d.unselectName(b),$("."+e+"-fselectAll",n).prop("checked",!1))}),$(n).undelegate("."+e+"-fselectAll","change"),$(n).delegate("."+e+"-fselectAll","change",function(){var a=$(this).is(":checked");a?($("."+e+"-nameCb",n).prop("checked",!0),d.fSelectAll()):($("."+e+"-nameCb",n).prop("checked",!1),d.fUnselectAll())}),$("#"+e+"-resetFilter",n).unbind().click(function(){$("#"+e+"-filterStr",n).val("请输入过滤关键字").select(),d.loadFilter()}),d},XUtil.XWaterfall=function(a){var b=XUtil.helpers.log,c=a.url||"",d=$.isArray(a.src)?a.src:[],e=$.isNumeric(Math.floor(a.colNum))?Math.floor(a.colNum):5,f=a.renderTo||document.body,g=$.isNumeric(a.colWidth)?a.colWidth:236,h=$.isNumeric(a.contentWidth)?a.contentWidth:234,i=$.isNumeric(Math.floor(a.initialSize))?a.initialSize:10*e,j=$.isNumeric(a.marginTop)?a.marginTop:10,k=$.isNumeric(a.fetchSize)?a.fetchSize:5*e,l=$.isFunction(a.renderer)?a.renderer:function(a){return a},m=$.isFunction(a.onFetch)?a.onFetch:function(){b("XWaterfall: fetching...")},n=$.isFunction(a.fetchCallback)?a.fetchCallback:function(a){b("XWaterfall: "+a)},o=[],p=[],q=[],r=[],s=0,t=0,u=0,v=!0,w=function(a){var b,c,d=r[0],e=r[0].currentHeight;for(b=0;b<r.length;b++)c=r[b],c.currentHeight<e&&(e=c.currentHeight,d=c);return d.append(a,"new"),q.push(a),d},x=function(){var a=[];r.forEach(function(b){a.push(b.currentTop)}),s=Math.max.apply(window,a)},y=function(){var a=[];r.forEach(function(b){a.push(b.currentHeight)}),t=Math.min.apply(window,a)},z=function(){var a=[];r.forEach(function(b){a.push(b.currentHeight)}),u=Math.max.apply(window,a)},A={};return A.set=function(a){return $.isNumeric(a.initialSize)&&(i=a.initialSize),$.isNumeric(a.colWidth)&&(g=a.colWidth),$.isNumeric(a.marginTop)&&(j=a.marginTop),$.isNumeric(a.fetchSize)&&(k=a.fetchSize),$.isNumeric(a.colNum)&&(e=a.colNum),$.isNumeric(a.contentWidth)&&(h=a.contentWidth),$.isFunction(a.onFetch)&&(m=a.onFetch),$.isFunction(a.fetchCallback)&&(n=a.fetchCallback),"url"in a&&(c=a.url),A},A.fetch=function(){var a,e,g;if(e=q.length,e<d.length)for(a=e;e+k>a;a++){if(!(a<d.length)){A.fetch();break}g=w(d[a]),o.push(g.shift())}else{if(""===c)return void(v=!1);m(f),v=!1,$.get(c,{fetchSize:k,currentSize:q.length}).done(function(a){"success"===a.message?a.src.length===k?(a.src.forEach(function(a){var b=w(a);o.push(b.shift())}),v=!0,n("success",f,a.src.length)):(b("XWaterfall: fetch failed, data.src.length is not equal to fetchsize."),v=!1):"all loaded"===a.message?(b("XWaterfall: no more resource!"),v=!1,n("allLoaded",f,a.src.length)):(b("XWaterfall: exception:"+a.message),v=!1,n("exception",f,a.src.length))}).fail(function(){b("XWaterfall: fetch failed!"),v=!1,n("error",f,data.src.length)})}return x(),y(),z(),$(f).css("height",u),A},A.reAttach=function(a){var b,c,d;return"top"===a?(b=o.pop(),b&&(c=b.col,d=r[c],d.prepend(b),p.push(d.pop()))):"bottom"===a&&(b=p.pop(),b&&(c=b.col,d=r[c],d.append(b,"old"),o.push(d.shift()))),x(),y(),z(),A},A.init=function(){var a,b;for(q=[],o=[],p=[],r=[],s=0,t=0,u=0,v=!0,$(f).empty().css("min-height",0).css("height",0).css("position","relative"),a=0;e>a;a++){var c=function(a){var b=["<div style='left:",a.left,"px;top:",a.top,"px;width:",h,"px;height:",a.height,"px;' id='",a.id,"' class='XWaterfall-component'>",l(a.model),"</div>"];return b.join("")};b={index:a,targetLeft:g*a,components:[],currentTop:$(f).offset().top,currentHeight:0,append:function(a,b){var d,e,g,i,k=this,m={};"new"===b?(g=XUtil.helpers.guid(),i=0===k.currentHeight?0:k.currentHeight+j,d=l(a),e=$("<div class='XWaterfall-component'>"+d+"</div>"),e.css("width",h).attr("id",g).appendTo(f).css("left",k.targetLeft).css("top",i),m.col=k.index,k.components.push(m),m.index=k.components.indexOf(m),m.id=g,m.top=i,m.left=k.targetLeft,m.height=e.outerHeight(),m.model=a,1===k.components.length?k.currentHeight=m.height:k.currentHeight+=m.height+j):(d=c(a),$(f).append(d),k.components.push(a),1===k.components.length?k.currentHeight=a.height:k.currentHeight+=a.height+j)},prepend:function(a){var b=this,d=c(a);$(f).append(d),b.components.unshift(a),b.currentTop>0&&(b.currentTop=parseInt(b.components[0].top))},shift:function(){var a=this,b=a.components.shift();return $("#"+b.id).remove(),a.currentTop=parseInt(a.components[0].top),b},pop:function(){var a=this,b=a.components.pop();return $("#"+b.id).remove(),a.currentHeight=a.currentHeight-b.height-j,b}},r.push(b)}for(a=0;i>a;a++)a<d.length&&w(d[a]);return z(),$(f).css("height",u),$(document).scrollTop(0),A},function(){var a=0;$(document).off("scroll.XWaterfall"),$(document).on("scroll.XWaterfall",function(){var b=$(document).scrollTop(),c=$(document).scrollTop()+$(window).height(),d=$(document).height(),e=d-c,f=b-s,g=t-c,h=b-a>0;if(h){if(0===p.length)v&&100>e&&A.fetch();else if(100>g)if(g>=0)A.reAttach("bottom");else for(;t<$(document).scrollTop()+$(window).height()&&p.length>0;)A.reAttach("bottom")}else if(100>f&&o.length>0)if(f>=0)A.reAttach("top");else for(;s>$(document).scrollTop()&&o.length>0;)A.reAttach("top");a=b})}(),A.init(),A},XUtil.helpers.preloadImages(XUtil.config.rootPath+"/images/sort_asc.gif",XUtil.config.rootPath+"/images/sort_desc.gif",XUtil.config.rootPath+"/images/closebtn.png",XUtil.config.rootPath+"/images/closebtn-hover.png"),exports.XUtil=XUtil,exports.myUtil=XUtil,XUtil});