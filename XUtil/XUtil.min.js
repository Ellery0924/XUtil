!function(a){"function"==typeof define&&define.amd?define(["jquery","jquery-ui"],a):a(jQuery)}(function(a){"use strict";var b={},c=window;return b.config={rootPath:"XUtil"},b.helpers={log:function(){var a=Array.prototype.slice.apply(arguments,[]);a.unshift("(XUtil) "),console.log.apply(console,a)},error:function(){if(arguments[0]){var a="(XUtil) "+arguments[0].toString();return new Error(a)}},bindInput:function(c,d){var e=d||"data-bind",f=b.helpers.bindInput,g={};if(c){if("string"==typeof c)void 0===d?(g={},g[c]="",f.call(window,g)):(g={},g[c]=d,f.call(window,g));else for(var h in c)if(c.hasOwnProperty(h))for(var i=a(h),j=0;j<i.length;j++){var k=a(h).eq(j),l=(c[h]||(k.attr(e)?k.attr(e):"")).toString(),m=k.is("input[type=text]"),n=k.is("textarea"),o=k.is("input[type=hidden]"),p=k.is("input[type=checkbox]"),q=k.is("input[type=radio]"),r=k.is("select");m||n||o||r?(k.val(l),k.trigger("change")):(p||q)&&("true"===l?(k.prop("checked",!0),k.trigger("change")):"false"===l&&(k.prop("checked",!1),k.trigger("change")))}}else g["["+e+"]"]="",f.call(window,g)},addShield:function(b,c,d){var e,f,g,h,i,j=d||1e4;return!b&&(b=document.body),b=a(b),e=b.offset().top,f=b.offset().left,g=b.outerWidth(),h=b.outerHeight(),b[0]===document.body&&(g="100%",h="100%"),a.isNumeric(c)||(c=.3),i=a("<div class='XUtil-pageShield'></div>"),i.css("position","absolute").css("z-index",j).css("background","#000").css("opacity",c).css("top",e).css("left",f).css("width",g).css("height",h).appendTo(document.body),i},removeShield:function(b){b?a(".XUtil-pageShield").remove():a(b).remove()},showErrorHint:function(b,c,d){var e=a(b.parentNode),f=a("<span class='errorHint'>* "+c+"</span>");return 0===e.find(".errorHint").length&&f.insertAfter(b),d&&f.addClass(d),f},clearErrorHint:function(b){b?a(a(b).parent()).find(".errorHint").remove():a(".errorHint").remove()},getUrlArgs:function(){var a,b,c,d,e={},f=window.location||f,g=f.search.substring(1),h=g.split("&");for(a=0;a<h.length;a++)b=h[a].indexOf("="),-1!==b&&(c=h[a].substring(0,b),d=decodeURI(h[a].substring(b+1)),e[c]=d);return e},toQuery:function(a){var b="?";for(var c in a)a.hasOwnProperty(c)&&(b+=c+"="+a[c]+"&");return b},getUrl:function(a,b){var c=helpers;return encodeURI(a+c.toQuery(b))},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:0&b&3|8;return c.toString(16)}).toUpperCase()},preloadImages:function(){var a;for(a=0;a<arguments.length;a++)(new Image).src=arguments[a].toString()}},b.XAccordion=function(c){var d,e=b.helpers.error,f=b.helpers.log,g=[],h={},i=c.titles||[],j=c.id||"XAccordion-"+b.helpers.guid(),k=c.animated||!1,l=a.isFunction(c.onShow)?c.onOpen:function(a){f("XAccordion: Container "+a.index+" is open")},m=a.isFunction(c.onRemove)?c.onRemove:function(a){return f("XAccordion: Container "+a.index+" is removed."),!0},n=c.closable||!1,o=c.className||"",p=c.iconClass||"";if(!("renderTo"in c&&a(c.renderTo)[0]))throw e("XAccordion: 目标div不合法，请检查option.renderTo属性！");d=c.renderTo;var q,r,s,t=a(d),u=function(b,c){var d,f,h,i,j="<div class='XAccordion-title'><span class='icon'></span><span class='titleText'></span><span class='closebtn'></span></div>",k="<div xa-title='"+c+" 'class='XAccordion-content'></div>",l="<div class='XAccordion-container'></div>";if(b=a(b)[0],!b)throw e("XAccordion.append: 要添加的dom元素不合法，请检查！");d={title:c,titleNode:void 0,contentNode:void 0,domNode:void 0,opened:!1},h=a(k).append(b),f=a(j),f.find(".titleText").html(c),i=a(l).append(f).append(h),d.titleNode=f,d.contentNode=h,d.domNode=i,g.push(d)},v=t.children();for(q=0;q<v.length;q++)r=v[q],s=""===i[q]?a(r).attr("xa-title"):i[q],a(r).removeAttr("xa-title"),u(r,s);return t.on("click",".titleText",function(){var b=a(this.parentNode.parentNode).attr("xa-index");h.show(b)}),t.on("click",".closebtn",function(){var b=a(this.parentNode.parentNode).attr("xa-index");h.remove(b)}),h.containers=g,h.titles=i,h.set=function(b){return"animated"in b&&(k=Boolean(b.animated)),a.isFunction(b.onShow)&&(l=b.onShow),a.isFunction(b.onRemove)&&(m=b.onRemove),"closable"in b&&(n=Boolean(b.closable)),"className"in b&&(o=b.className),"iconClass"in b&&(p=b.iconClass),"id"in b&&(j=b.id),h},h.show=function(a){var b;for(b=0;b<g.length;b++)b!==parseInt(a)&&h.hide(b);return g[a].opened||(k?g[a].contentNode.slideDown("fast"):g[a].contentNode.show(),g[a].opened=!0,g[a].domNode.addClass("opened"),l(g[a])),h},h.hide=function(a){return g[a].opened=!1,k?g[a].contentNode.slideUp("fast"):g[a].contentNode.hide(),g[a].domNode.removeClass("opened"),h},h.remove=function(a){return m(g[a])&&(g.splice(a,1),h.init()),h},h.append=function(a,b){return u(a,b),h.init(),h},h.init=function(){if(t.empty(),t.addClass("XAccordion").addClass(o).attr("xa-id",j),g.length>0){for(q=0;q<g.length;q++)t.append(g[q].domNode),g[q].domNode.attr("xa-index",q),g[q].index=q,0!==q&&(g[q].contentNode.hide(),g[q].opened=!1);n||t.find(".closebtn").hide(),t.find(".icon").addClass(p),g[0].contentNode.show(),g[0].opened=!0,g[0].domNode.addClass("opened")}return h},h.init(),h},b.XDialog=function(c){var d,e,f,g,h,i,j,k,l,m=b.helpers,n=m.log,o=c.width||"auto",p=c.height||"auto",q=c.top||.5,r=c.left||.5,s=c.closable||!1,t=a.isFunction(c.onClose)?c.onClose:function(){n("XDialog: XDialog is closed.")},u=a.isFunction(c.onOpen)?c.onOpen:function(){n("XDialog: XDialog is opened.")},v=!1,w=c.id||"XDialog-"+m.guid(),x=c.className||"",y=c.title||"XDialog",z=c.zIndex||1e3,A=c.draggable||!1,B=c.animated||!1,C=c.content||"",D=!0,E=!1,F=!1,G={};return"autoOpen"in c&&c.autoOpen===!0&&(v=!0),f=a("<div class='XDialog' id='"+w+"'><div class='XDialogTitle'><span class='titleText'></span><span class='closeBtn'></span></div><div class='XDialogContent'></div></div>")[0],g=a(f).find(".XDialogContent")[0],h=a(f).find(".closeBtn")[0],i=a(f).find(".titleText")[0],a(document.body).append(f).css("position","relative"),a(h).click(function(a){a.stopPropagation(),G.close()}),G.domNode=f,G.contentNode=g,G.closeBtn=h,G.init=function(){return a(f).css("position","fixed").css("top",q).css("left",r).css("z-index",z).hide().addClass(x),a(g).css("min-width","200px").css("min-height","200px").css("height",p).css("width",o).html(C),a(f).find(".closeBtn").hide(),d=a(f).outerWidth(),e=a(f).outerHeight(),a(f).css("margin-top",-e/2).css("margin-left",-d/2),a(f).find(".titleText").html(y),v&&G.open(),s&&a(f).find(".closeBtn").show(),A&&(a(i).css("cursor","move"),a(i).on("mousedown."+w,function(a){1===a.which&&(F=!0,j=a.pageX,k=a.pageY)}),a(document).on("mousemove."+w,function(b){var c,d,e,g;F&&(i.onselectstart=function(){return!1},c=b.pageX,d=b.pageY,e=c-j,g=d-k,q+=+g,r+=e,a(f).css("top",q).css("left",r),j=c,k=d)}),a(document).on("mouseup."+w,function(){F=!1,i.onselectstart=function(){return!0}})),G},G.set=function(b){return"width"in b&&(o=b.width),"height"in b&&(p=b.height),"top"in b&&(q=b.top),"left"in b&&(r=b.left),"title"in b&&(y=b.title),"className"in b&&(x=b.className),"closable"in b&&(s=Boolean(b.closable)),"onClose"in b&&a.isFunction(b.onClose)&&(t=b.onClose),"onOpen"in b&&a.isFunction(b.onOpen)&&(u=b.onOpen),"autoOpen"in b&&(v=Boolean(b.autoOpen)),"zIndex"in b&&a.isNumeric(b.zIndex)&&(z=b.zIndex),"draggable"in b&&(A=b.draggable),"animated"in b&&(B=Boolean(b.animated)),"content"in b&&(C=b.content.toString()),G},G.open=function(){return E||(B?a(f).fadeIn("fast"):a(f).show(),E=!0,l=m.addShield(document.body,.5,z-1),u(),D&&(q=a(window).height()*q-a(f).outerHeight()/2,r=a(window).width()*r-a(f).outerWidth()/2,a(f).css("top",q).css("left",r).css("margin-top",0).css("margin-left",0),D=!1)),G},G.close=function(){return E&&(B?a(f).fadeOut("fast"):a(f).hide(),E=!1,m.removeShield(),t()),G},G.init(),G},b.Class=function(a){function c(){this.init.apply(this,arguments),c.instances[b.helpers.guid()]=this}var d;return c.instances={},c.find=function(a){return a&&c.instances[a]?c.instances[a]:void 0},a&&(d=function(){},d.prototype=a.prototype,c.prototype=new d,c.parent=a,c.parentProto=a.prototype,c.parentInit=a.prototype.init),c.prototype.init=function(){},c.prototype.constructor=Object,c.include=function(a){var b;for(b in a)a.hasOwnProperty(b)&&(c.prototype[b]=a[b])},c.extend=function(a){var b;for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b])},c},b.loader={option:{root:"",isSync:!0},config:function(a){var b=this.option;for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])},load:function(){var a,b=arguments[0],c=arguments[1]||function(){console&&console.log("all loaded")},d=this.option.root?this.option.root.replace(/\/$/,"")+"/":"",e=/.js/,f=0,g=!1;a=b;for(var h=0;h<a.length;h++){var i,j=a[h];j="object"==typeof j?j:{path:j},i=/^(?:http:\/\/|\/)/.test(j.path);var k,l,m,n,o,p,q,r=/^(src|href|type|path|rel)$/,s=document.head;if(e.test(j.path)){if(l=i?j.path:d+j.path,k=document.createElement("script"),this.option.isSync){if(m=new XMLHttpRequest,m.open("GET",l,!1),m.send(),200!==m.status)throw new Error(m.statusText);n=m.responseText,(window.execScript||function(a){window.eval.call(window,a)})(n),s.appendChild(k),k.type="text",k.text=n,k.src=l,k.type="text/javascript"}else k.src=l,f++,k.onload=k.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||0===--f&&(g=!0,c())},s.appendChild(k);for(var t in j)j.hasOwnProperty(t)&&!r.test(t)&&k.setAttribute(t,j[t])}else{o=document.createElement("link"),p=i?j.path:d+j.path,q=j.rel||"stylesheet",o.href=p,o.rel=q;for(var u in j)j.hasOwnProperty(u)&&!r.test(u)&&o.setAttribute(u,j[u]);s.appendChild(o)}}console&&console.log("all done!"),this.option.isSync&&c()}},b.XMenu=function(c){var d=b.helpers.log,e=c.id||"XMenu-"+b.helpers.guid(),f=c.renderTo,g=c.menuClass||"",h=c.textClass||"",i=c.iconClass||"",j=c.labelClass||"",k=c.iconRightClass||"",l=c.subMenuMargin||20,m=[],n=[],o=[],p=function(c,e){var f=c.id||"XMenu-SimpleItem-"+b.helpers.guid(),g=a("<li class='XMenuItem XMenuSimpleItem' id='"+f+"'></li>"),l=a("<div class='XMenuItemIcon' style='display:inline-block;'></div>"),n=a("<div class='XMenuItemLabelText' style='display:inline-block;'></div>"),o=a("<div class='XMenuItemLabel simpleItemLabel'></div>"),p=a("<div class='XMenuItemIconRight' style='display:inline-block;'></div>"),q=c.label,r=c.onClick||function(a){d(a)},t=c.iconClass||i,u=c.iconRightClass||k,v=c.textClass||h,w=c.labelClass||j;m.push(c),c.domNode=g,g.data("itemData",c.itemData),o.append(l).append(n).append(p).appendTo(g),n.html(q).addClass(v),l.addClass(t),p.addClass(u),o.addClass(w),g.click(function(){r(c.data,c,g)}),"horizontal"===s.type&&g.bind("mouseenter",function(){var a;a=c.parent.subMenu?c.parent.subMenu:c.parent.menuSrc,a.forEach(function(a){a.close&&a.close()})}),a(e).append(g)},q=function(c,e){var f,m=c.label,o=c.id||"XMenu-PopupItem-"+b.helpers.guid(),r=a("<div class='XMenuItem XMenuPopupItem' id='"+o+"'></div>"),t=a("<ul class='XMenuSubMenu'></ul>"),u=a("<li class='XMenuItemLabel popupItemLabel' style='cursor:pointer;'></li>"),v=a("<div class='XMenuItemIcon' style='display:inline-block;'></div>"),w=a("<div class='XMenuItemLabelText' style='display:inline-block;'></div>"),x=a("<div class='XMenuItemIconRight' style='display:inline-block;'></div>"),y=c.textClass||h,z=c.iconClass||i,A=c.labelClass||j,B=c.subMenuClass||g,C=c.iconRightClass||k,D=c.onClick||function(a){d(a)};n.push(c),c.domNode=r,r.data("itemData",c.data),a(e).append(r),t.hide(),"horizontal"===s.type&&t.css("position","absolute"),t.addClass(B),w.html(m).addClass(y),v.addClass(z),x.addClass(C),u.addClass(A),u.append(v).append(w).append(x).appendTo(r),w.click(function(){D(c.data,c,r)}),f=c.subMenu,f.forEach(function(a){var b=a.itemClass;a.parent=c,"simple"===b?p(a,t):"popup"===b&&q(a,t)}),t.appendTo(r);var E=function(){var a,b,d,e,f,g=s.openDirection;a=parseInt(r.css("width")),b=isNaN(parseInt(t.css("border-left-width")))?0:parseInt(t.css("border-left-width")),d=isNaN(parseInt(t.css("border-top-width")))?0:parseInt(t.css("border-top-width")),"vertical"===s.type?(s.animated===!0?t.slideDown("fast"):t.show(),t.css("margin-left",l).css("width",a-l-2*b)):("bottomRight"===g?(e=u.parent().parent().outerWidth()+u.parent().position().left,f=u.position().top,t.css("top",f-d+"px").css("left",parseInt(e-2*b)+"px")):"bottomLeft"===g?(e=u.parent().position().left-u.parent().parent().outerWidth(),f=u.position().top,t.css("top",f-d+"px").css("left",parseInt(e)+"px")):"topRight"===g?(e=u.parent().parent().outerWidth()+u.parent().position().left,f=u.position().top-t.outerHeight()+u.outerHeight(),t.css("top",f+d+"px").css("left",parseInt(e-2*b)+"px")):"topLeft"===g&&(e=u.parent().position().left-u.parent().parent().outerWidth(),f=u.position().top-t.outerHeight()+u.outerHeight(),t.css("top",f+d+"px").css("left",parseInt(e)+"px")),s.animated===!0&&"horizontal"===s.type?t.fadeIn("fast"):t.show()),u.find(".XMenuItemIconRight").addClass("rotate"),u.addClass("opened"),u.attr("opened","opened"),x.addClass("subExpanded"),c.isOpened=!0},F=function(){var b=this.domNode.find(".XMenuSubMenu"),c=this.domNode.find(".XMenuItemLabel"),d=this.domNode.find(".XMenuItemIconRight");b.find(".XMenuPopupItem").removeAttr("opened"),d.removeClass("rotate"),s.animated===!0&&"vertical"===s.type?b.slideUp("fast"):s.animated===!0&&"horizontal"===s.type?b.fadeOut("fast"):b.hide(),this.subMenu.forEach(function(b){"popupItem"===b.itemClass&&a.proxy(F,b)()}),c.removeClass("opened"),c.attr("opened")&&c.removeAttr("opened"),d.removeClass("subExpanded"),this.isOpened=!1};c.open=E,c.close=F,c.isOpened=!1,"vertical"===s.type?x.click(function(){var b=a(this.parentNode).attr("opened");"opened"===b?c.close():c.open()}):r.bind("mouseenter",function(){var b,d,e=this;d=c.parent.subMenu?c.parent.subMenu:c.parent.menuSrc,a(e).find(".XMenuItemLabel").attr("opened","opened"),d.forEach(function(a){a!==c&&a.close&&a.close()}),setTimeout(function(){b=a(e).find(".XMenuItemLabel").attr("opened"),b&&c.open()},400)})},r=function(a){for(var b,c=[],d=a;void 0!==d.parent&&void 0!==d.parent.subMenu;)b=d.parent.subMenu.indexOf(d),c.push(b),d=d.parent;return c.push(d.parent.menuSrc.indexOf(d)),c.reverse().join("-")};a(document).click(function(b){var c=b.target;"horizontal"===s.type&&(a(s.domNode).find(c)[0]||s.closeAll())}),a(document).bind("mousemove",function(b){var c,d,e,f=b.target;c=b.pageX,a(s.domNode).find(f)[0]||"horizontal"!==s.type||s.allItems.forEach(function(b){"popup"===b.itemClass&&b.isOpened===!0&&(d=b.domNode,e=a(d).offset().left,-1!==s.openDirection.toLowerCase().search("right")?e>c&&b.close():-1!==s.openDirection.toLowerCase().search("left")&&e+a(d).outerWidth()<c&&b.close())})});var s={};return s.type=c.type||"vertical",s.animated=!1,"animated"in c&&c.animated===!0&&(s.animated=!0),s.menuSrc=[],s.allItems=[],s.openDirection=c.openDirection||"bottomRight",s.maxLevel=0,s.append=function(a){return a&&a.itemClass&&("popup"===a.itemClass||"simple"===a.itemClass)&&(s.menuSrc.push(a),a.parent=s),s},s.open=function(a){var b,c,d=a.split("-"),e=s.menuSrc[d[0]];if(!e.open)return e;for(e.open(),b=1;b<d.length;b++)c=d[b],e.subMenu[c]&&e.subMenu[c].open&&e.subMenu[c].open(),e=e.subMenu[c];return e},s.closeAll=function(){return s.menuSrc.forEach(function(a){"popup"===a.itemClass&&a.close()}),s},s.init=function(){var b=a("<div class='XMenu' id='"+e+"'></div>")[0],c=a(f)[0];if(a(f).length>1)throw error("XMenu: option.renderTo属性设置有误！");return a(b).addClass(g).css("position","relative"),a(c).empty().append(b),s.menuSrc.forEach(function(a){var c=a.itemClass;a.parent=s,"simple"===c?p(a,b):"popup"===c&&q(a,b)}),o=m.concat(n),o.forEach(function(a){var b;a.location=r(a),a.rootMenu=s,b=a.location.split("-").length,b>s.maxLevel&&(s.maxLevel=b)}),s.domNode=b,s.allItems=o,a(b).children().addClass("firstLevelItem"),a(b).addClass("vertical"===s.type?"vertical":"horizontal"),s},s},b.MenuItem=function(a){return{itemClass:"simple",label:a.label||"空",onClick:a.onClick||function(a){var c=b.helpers.log;c(a)},option:a,iconClass:a.iconClass||"",labelClass:a.labelClass||"",id:a.id||"XMenu-SimpleItem-"+b.helpers.guid(),textClass:a.textClass||"",iconRightClass:a.iconRightClass||"",data:a.data||{},parent:void 0,remove:function(){var a;return this.parent.subMenu?(a=this.parent.subMenu.indexOf(this),-1!==a&&this.parent.subMenu.splice(a,1)):this.parent.menuSrc&&(a=this.parent.menuSrc.indexOf(this),-1!==a&&this.parent.menuSrc.splice(this.parent.menuSrc.indexOf(this),1)),this.rootMenu&&this.rootMenu.init&&this.rootMenu.init(),this},appendTo:function(a){return void 0===a||void 0===a.parent?this:this.parent===a?this:(this.remove(),a.append?a.append(this):(a.itemClass="popup",a.subMenu=[],a.subMenuClass="",a.append=function(a){return a&&a.itemClass&&("popup"===a.itemClass||"simple"===a.itemClass)&&(this.subMenu.push(a),a.parent=this),this.rootMenu&&this.rootMenu.init&&this.rootMenu.init(),this},a.append(this)),this.rootMenu&&this.rootMenu.init&&this.rootMenu.init(),this)},insertAt:function(a){return this.remove(),this.parent.subMenu?this.parent.subMenu.splice(a,0,this):this.parent.menuSrc.splice(a,0,this),this.rootMenu&&this.rootMenu.init&&this.rootMenu.init(),this}}},b.PopupMenuItem=function(a){var c=b.MenuItem(a);return c.id=a.id||"XMenu-PopupItem-"+b.helpers.guid(),c.itemClass="popup",c.subMenu=[],c.subMenuClass=a.subMenuClass||"",c.append=function(a){return a&&a.itemClass&&("popup"===a.itemClass||"simple"===a.itemClass)&&(c.subMenu.push(a),a.parent=c),c.rootMenu&&c.rootMenu.init&&c.rootMenu.init(),c},c.open=function(){},c.close=function(){},c},b.XSuspendedMenu=function(c){var d,e=b.helpers.error,f="XSuspendedMenuContainer-"+b.helpers.guid(),g=c.bindTo||"mouse",h=c.offset||{top:0,left:0},i=c.animated||!1;d=i?!0:!1;var j=a("<div class='XSuspendedMenuContainer'></div>"),k={};if(j.css("position","absolute").attr("id",f).attr("opened","false").appendTo(document.body).hide(),c.renderTo="#"+f,c.animated=d,c.type="horizontal",k.menu=b.XMenu(c),k.menu.init(),k.container=j,k.bindToDom=void 0,k.isOpened=!1,k.target=void 0,!a(g)[0])throw e("XSuspendedMenu: 目标dom不存在，请检查option.bindTo属性.");return k.bindToDom=a(g),k.show=function(b,c){var d,e,f,g,l;return d=a(document).outerWidth()-k.menu.maxLevel*j.outerWidth(),e=a(document).outerHeight()-k.menu.maxLevel*j.outerHeight(),d>b?(j.css("left",b+3+h.left),f="Right"):(j.css("left",b-j.outerWidth()-3+h.left),f="Left"),e>c?(j.css("top",c+3+h.top),g="bottom"):(j.css("top",c-j.outerHeight()-3+h.top),g="top"),l=g+f,k.menu.openDirection=l,k.menu.init(),i?j.fadeIn(150):j.show(),j.attr("opened","true"),k.isOpened=!0,k},k.init=k.menu.init,k.hide=function(){return i?j.fadeOut(150):j.hide(),j.attr("opened","false"),k.target=void 0,k.isOpened=!1,k},a(k.bindToDom).bind("contextmenu",function(a){var b=a.pageX,c=a.pageY;a.preventDefault(),a.stopPropagation(),k.isOpened?(k.hide(),k.target=a.currentTarget,setTimeout(function(){k.show(b,c)},150)):k.show(b,c)}),a(document.body).bind("click",function(a){var b=a.target;0!==a.button||j.find(b)[0]||"true"!==j.attr("opened")||k.hide()}),k},b.XPopout=function(c){var d=b.helpers.error,e={},f=c.renderTo,g=c.id||"XPopout-"+b.helpers.guid(),h=c.width||"auto",i=c.height||"auto",j=c.animation||"default",k=c.position||"lowerLeft",l=a(f)[0],m=!1,n=c.className||"",o=c.content||"",p=c.triggerBy||"click",q=c.offset||{top:0,left:0},r=c.onOpen||function(){},s=c.onClose||function(){},t=a("<div class='xPopout' id='"+g+"'></div>");if(void 0!==c.autoOpen&&c.autoOpen===!0&&(m=!0),void 0===l)throw d("XPopout: 配置参数有误，请检查option.renderTo属性");return"slide"!==j||"upperLeft"!==k&&"upperRight"!==k||(j="default"),t.append(o).addClass(n),t.appendTo(document.body),t.css("position","absolute").css("height",i||"auto").css("width",h||"auto").css("display","none").css("background-color","#fff").css("padding","10px"),e.bindDom=l,e.popout=t[0],e.setPosition=function(b){var c=a(l).offset(),d=l.offsetWidth,f=l.offsetHeight,g={top:c.top+f+Number(q.top),left:c.left+q.left},h={top:c.top+f+Number(q.top),left:c.left+d-t.outerWidth()+Number(q.left)},i={top:c.top-t.outerHeight()+Number(q.top),left:c.left+Number(q.left)},j={top:c.top-t.outerHeight()+Number(q.top),left:c.left+d-t.outerWidth()+Number(q.left)},k=function(a){t.css("top",a.top),t.css("left",a.left)};return"lowerLeft"===b?(k(g),e.position=b):"lowerRight"===b?(k(h),e.position=b):"upperLeft"===b?(k(i),e.position=b):"upperRight"===b?(k(j),e.position=b):(k(g),e.position="lowerLeft"),e},e.open=function(){return"closed"===e.status&&(r(t[0]),e.setPosition(k),"fade"===j?t.fadeIn("fast"):"slide"!==j||"lowerLeft"!==k&&"lowerRight"!==k?t.show():t.slideDown("fast"),e.status="opened"),e},e.close=function(){return"opened"===e.status&&(s(t[0]),"fade"===j?t.fadeOut("fast"):"slide"!==j||"lowerLeft"!==k&&"lowerRight"!==k?t.hide():t.slideUp("fast"),e.status="closed"),e},e.setPosition(k),m===!1?e.status="closed":(e.status="opened",e.open()),function(){var b=!1,c=function(a,c){var d;a.stopPropagation(),d=a.target,0!==t.children().length&&d!==t[0]&&d!==l&&void 0===t.find(d)[0]||0===t.children().length&&d!==l&&d!==t[0]?(b=!1,"hover"!==p||c?e.close():setTimeout(function(){b||"opened"!==e.status||e.close()},400)):b=!0};"hover"===p?(a(l).on("mouseenter.XPopoutOpen",function(){b=!0,setTimeout(function(){b&&e.open()},350)}),a(document).on("mouseover.XPopoutClose",function(a){c.call(this,a)}),a(document).on("click.XPopoutClose",function(a){c.call(this,a,!0)})):(a(l).on("click.XPopoutOpen",function(){e.open()}),a(document).on("click.XPopoutClose",function(a){c.call(this,a)}))}(),e},b.XTable=function(c){var d=b.helpers.log,e=b.helpers.error,f={},g=c.id||"XTable-"+b.helpers.guid();if(!c.src)throw e("XTable: 配置参数有误，请检查src属性是否为合法的JSON数据");var h=b.config.rootPath;if(!h||""===h)throw e("XTable: 配置参数有误，请检查myUtil.config对象");var i=!0;"colEditable"in c&&c.colEditable===!1&&(i=!1);var j=!0;"hasFilter"in c&&c.hasFilter===!1&&(j=!1);var k=c.filterType||1,l=a(c.renderTo)[0];if(!l||a(c.renderTo).length>1)throw e("XTable: 配置参数有误，请检查option.renderTo属性");var m=c.fontSize||"14px";a(l).empty().css("font-size",m);var n=[],o=[],p=[],q=[],r=[],s=[];c.columns.forEach(function(a){if(n.push(a.name),j===!0?"hasFilter"in a&&a.hasFilter!==!0?"hasFilter"in a&&a.hasFilter===!1&&r.push(!1):r.push(!0):r.push(!1),"sortable"in a&&a.sortable!==!0?"sortable"in a&&a.sortable===!1&&s.push(!1):s.push(!0),!("data"in a))throw e("XTable.js: 配置参数有误，请检查option.column的data属性。");o.push(a.data),p.push(a.width),"visible"in a&&a.visible!==!0||q.push(a.data)});var t=!0,u=[],v=c.beforeSelect||function(){},w=c.selectCb||function(){},x=c.beforeDeselect||function(){},y=c.deselectCb||function(){};"selectable"in c&&c.selectable===!1&&(t=!1);var z,A=c.beforeDelete||function(){return!0},B=c.deleteCb||function(){};z="deletable"in c&&c.deletable===!0?!0:!1;var C=c.editable||!1,D=c.showEditCol||!1,E=[],F=0,G=C&&c.editCb||function(){},H=C&&c.beforeEdit||function(){},I="top";"controllerPosition"in c&&"bottom"===c.controllerPosition&&(I="bottom");var J=c.pageSizes||[10,20,50,100,200],K=parseInt(J[0]),L=c.linkCols,M=[],N=a("<div class='xTable-table'></div>"),O=a("<div class='xTable-controller'></div>"),P=a("<div class='xTable-pageController'></div>"),Q=a("<div class='xTable-pageSizeController'></div>"),R=a("<li class='functionButton prevButton ui-state-default ui-corner-all'><span class='ui-icon ui-icon-seek-prev'></span></li>"),S=a("<li class='functionButton nextButton ui-state-default ui-corner-all'><span class='ui-icon ui-icon-seek-next'></span></li>"),T=a("<li class='functionButton firstButton ui-state-default ui-corner-all'><span class='ui-icon ui-icon-seek-first'></span></li>"),U=a("<li class='functionButton lastButton ui-state-default ui-corner-all'><span class='ui-icon ui-icon-seek-end'></span></li>"),V=a("<input type='text' class='xTable-gotoBox' value='1'/>"),W=a("<span class='xTable-maxPage'></span>"),X=a("<table class='xTable-view' border='1' width='100%'></table>"),Y=a("<select class='xTable-pageSizeSelector'></select>");J.forEach(function(a){Y.append("<option value='"+a+"'>"+a+"</option>")}),P.append(T).append(R).append(V).append(W).append(S).append(U),O.append(P).append(Q),"top"===I?N.append(O).append(X):N.append(X).append(O),a(l).append(N);var Z=a("<input class='xTable-selectAll' type='checkbox'/>"),$=a("<td class='xTable-selectAllTd' class='xTable-selectAllTd'></td>");$.append(Z),X.empty();var _=[],aa=a("<tr class='xTable-Header'></tr>");if(t&&aa.append($),n.forEach(function(b,c){var d=a("<td class='colName' colName='"+b+"'><div class='colNameText'>"+b+"</div></td>");if(aa.append(d),_.push(d),r[c]&&a("<li class='openFilterLi ui-state-default ui-corner-all' title='.ui-icon-search'><span class='ui-icon ui-icon-search'></span></li>").appendTo(d),s[c]){var e=a("<div class='orderTag'></div>");d.attr("sortable","true").append(e)}else d.attr("sortable","false")}),C){var ba=a("<td class='editHeader' colName='edit'>编辑</td>");aa.append(ba),D||ba.hide()}p.forEach(function(a,b){_[b]&&_[b].css("width",a)}),o.forEach(function(a,b){_[b]&&_[b].attr("srcName",a)}),X.append(aa),a(l).find("li").hover(function(){a(this).addClass("ui-state-hover"),a(this).css("cursor","pointer")},function(){a(this).removeClass("ui-state-hover"),a(this).css("cursor","default")}),a("#"+g+"-setVCols",N).remove();var ca=a("<div id='"+g+"-setVCols'></div>");ca.dialog({autoOpen:!1,width:400,resizable:!1,title:"设置显示的列",buttons:[{text:"确定",id:g+"-submitVCols",click:function(){}},{text:"取消",id:g+"-closeSetVCols",click:function(){a(this).dialog("close")}}],position:{my:"top+10%",at:"top+10%",of:window},open:function(){b.helpers.addShield(document.body)},close:function(){b.helpers.removeShield()}}),a(N).append(ca.parent());var da=a("<input type='button' value='设置' class='openSetV'/>");i&&(da.insertAfter(U),da.button());var ea=a("<input type='checkbox' class='showAllCol' checked='true'/>"),fa=a("<div class='subVCol showAllColSpan'></div>");fa.append(ea).append("全部").appendTo(ca),c.columns.forEach(function(b){var c=a("<div class='subVCol'></div>"),d=a("<input type='checkbox' class='vColCb' srcName='"+b.data+"' colName='"+b.name+"'/>");c.append(d).append(b.name),"visible"in b&&b.visible!==!0?(d.prop("checked",!1),ea.prop("checked",!1)):d.prop("checked",!0),ca.append(c)});var ga=a("<input type='button' value='全选当前页' class='funcButton'/>");t&&(ga.appendTo(P),ga.button());var ha;z&&(ha=a("<input type='button' value='剔除选中条目' class='funcButton deleteBtn'/>").button({disabled:!0}),ha.appendTo(P));var ia=function(b,c,d,e,g){b=parseInt(b);var h,i;!isNaN(b)&&b>=0&&b<n.length&&(h=a(".dataTr",N).toArray(),i=[],h.forEach(function(c){a(c).find(".dataCell")[b]&&i.push(a(c).find(".dataCell")[b])}),i.forEach(function(b,i){var j=parseInt(a(h[i]).attr("srcindex")),k=f.orgSrc[j],l=a(b).text(),m=a("<a href=''>"+l+"</a>");"button"===g&&(m=a("<input type='button' value='"+l+"'>").button()),c&&"button"!==g?m.attr("href",c(j,k,m)):"button"!==g&&m.attr("href","javascript: void (0)"),d&&"button"===g?m.attr("target",d):m.attr("target","_blank"),c||m.attr("target","_self"),e&&m.click(function(){var a=this;e(k,a)}),a(b).attr("editInvalid","true"),a(b).empty().append(m)}))},ja=function(c){a(".dataTr",N).remove(),a(".tempMessage",N).remove(),a("<div class='tempMessage'>"+c+"</div>").insertAfter(N.find(".xTable-view")),b.helpers.addShield(N)},ka=function(){a(N).find(".tempMessage").remove(),b.helpers.removeShield()};return f.orgSrc=c.src,f.id=g,f.headers=_,f.attrs=o,f.src=f.orgSrc.slice(),f.option=c,f.firstButton=T,f.prevButton=R,f.gotoBox=V,f.nextButton=S,f.lastButton=U,f.pageSizeSelector=Y,f.pageController=P,f.controller=O,f.view=X,f.src.forEach(function(a,b){a.selected=!1,a.orgIndex=b}),f.init=function(){var b,c,d,e=f.src,g=Math.ceil(e.length/K);for(M=[],u=[],Q.empty().append("共"+e.length+"条结果，每页显示").append(Y).append("条"),W.html(" / "+g),a(".xTable-selectAll",N).prop("checked",!1),b=0;b<e.length;b++)if(e[b].selected=!1,(b+1)%K===0){for(d=[],c=K;c>0;c--)e[b-c+1].srcIndex=b-c+1,d.push(e[b-c+1]);M.push(d)}else if(b===e.length-1){for(d=[],c=K*(g-1);c<e.length;c++)e[c].srcIndex=c,d.push(e[c]);M.push(d)}f.loadPage(1)},f.destroy=function(){a(l).empty()},f.loadPage=function(b){var d,f,g,h;return 0!==F?void alert("请先保存当前正在编辑的行！"):0===M.length?void a(".dataTr",N).remove():void(b>0&&b<=M.length&&(a(".dataTr",N).remove(),V.val(b),b=parseInt(b),d=M[b-1],d.forEach(function(d,g){var h=a("<tr class='dataTr'></tr>"),i=a("<input type='checkbox' class='selectRow'/>"),j=a("<td class='rowCb'></td>");h.attr("index",K*(b-1)+g),t&&d.selected&&(i.prop("checked",!0),h.addClass("rowSelect")),h.attr("srcIndex",d.orgIndex).data("srcObj",d),j.append(i),t&&h.append(j),h.appendTo(X),o.forEach(function(b,f){var g=a("<td class='dataCell' srcName='"+b+"'></td>");if(!(b in d))throw e("XTable.js: 源JSON数据与data属性关联失败，请检查参数对象：column的data属性输入是否正确。");g.append(d[b]),g.appendTo(h),C&&"editable"in c.columns[f]&&c.columns[f].editable===!1&&g.attr("editInvalid","true")}),C&&(f=a("<td class='editTd'><input type='button' class='editBtn' value='编辑'/></td>"),f.find("input").button(),h.append(f),D||f.hide())}),L&&L.length>0&&L.forEach(function(a){ia(a.colIndex,a.renderer,a.target,a.onclick,a.type)}),g=a(".dataCell",N).toArray(),h=a(".colName",N).toArray(),g.forEach(function(b){var c=a(b).attr("srcName");-1===q.indexOf(c)&&a(b).hide()}),h.forEach(function(b){var c=a(b).attr("srcName");-1===q.indexOf(c)?a(b).hide():a(b).show()})))},f.selectRow=function(b){var c=parseInt(a(b).attr("index"));v(f.getSelectedData(),b),a(b).attr("select","selected"),a(b).find("input[type=checkbox]").prop("checked",!0),-1===u.indexOf(c)&&(u.push(c),f.src[c].selected=!0,a(b).addClass("rowSelect")),w(f.getSelectedData(),b),u.length>0&&z&&0===F&&ha.button({disabled:!1}),d("XTable-Filter.selectRow: The rows been selected are "),d(f.getSelectedData())},f.unselectRow=function(b){var c=a(b).attr("index"),e=u.indexOf(parseInt(c));x(f.getSelectedData(),b),a(b).removeClass("rowSelect").removeClass("rowHover").removeClass("rowSelect").removeAttr("select"),a(b).find("input[type=checkbox]").prop("checked",!1),a(".xTable-selectAll",N).prop("checked",!1),-1!==e&&(u.splice(e,1),f.src[c].selected=!1),y(f.getSelectedData(),b),0===f.getSelectedData().length&&z&&ha.button({disabled:!0}),d("XTable-Filter.unselectRow: The rows been selected are "),d(f.getSelectedData())},f.selectAll=function(){var b;for(v(f.getSelectedData()),a(".xTable-selectAll",N).prop("checked",!0),a(".selectRow",N).prop("checked",!0),u=[],a(".dataTr",N).attr("select","selected").addClass("rowSelect"),b=0;b<f.src.length;b++)u.push(b),f.src[b].selected=!0;u.length>0&&z&&0===F&&ha.button({disabled:!1}),w(f.getSelectedData())},f.unselectAll=function(){var b;for(x(f.getSelectedData()),u=[],b=0;b<f.src.length;b++)f.src[b].selected=!1;a(".selectRow",N).prop("checked",!1),a(".xTable-selectAll",N).prop("checked",!1),a(".dataTr",N).removeAttr("select").removeClass("rowSelect").removeClass("rowHover"),0===f.getSelectedData().length&&z&&ha.button({disabled:!0}),y(f.getSelectedData())},f.setPageSize=function(b){var c,d,e=Y[0].options,g=-1;if(0!==F)return void alert("请先保存当前正在编辑的行！");for(K=parseInt(b),a(".orderTag",N).empty(),c=0;c<e.length;c++)if(d=e[c],parseInt(d.value)===K){g=c;break}Y[0].selectedIndex=g,f.init()},f.toFirstPage=function(){f.loadPage(1)},f.toLastPage=function(){f.loadPage(M.length)},f.toPrevPage=function(){var a=parseInt(V.val());a>1&&f.loadPage(a-1)},f.toNextPage=function(){var a=parseInt(V.val());a<M.length&&f.loadPage(a+1)},f.getSelectedData=function(){var a=[];return u.forEach(function(b){a.push(f.src[b])}),a},f.setVisibleCols=function(a){return 0!==F?void alert("请先保存当前正在编辑的行！"):(q=a,void f.init())},f.editRow=function(b){var c=a(b).find(".dataCell").toArray();c.forEach(function(b){var c;a(b).attr("editInvalid")||(c=a(b).html(),a(b).empty().append("<input class='editInput' type='text' value='"+c+"'/>"))}),a(a(b).find(".editBtn")).val("保存"),F++,a(".xTable-pageSizeSelector",N).prop("disabled",!0),a("input[type=button]:not(.editBtn)",N).button({disabled:!0})},f.saveRow=function(b){var c,e=a(b).find(".dataCell").toArray(),g=a(b).attr("srcindex"),h=a(b).attr("index"),i=f.orgSrc[h];return H(i,b),e.forEach(function(b){var c="",d=a(b).attr("srcname");a(b).attr("editInvalid")||(c=a(a(b).find(".editInput")).val(),
"number"==typeof targetAttr?isNaN(Number(c))?(f.src[h][d]=0/0,f.orgSrc[g][d]=0/0,a(b).html(0/0)):(f.src[h][d]=Number(c),f.orgSrc[g][d]=Number(c),a(b).html(c)):(f.src[h][d]=c,f.orgSrc[g][d]=c,a(b).html(c)))}),-1===E.indexOf(g)&&E.push(g),c=f.getEditedData(),d("XTable-Filter.saveEdit: The rows been edited are "),d(c),a(a(b).find(".editBtn")).val("编辑"),F--,0===F&&(a(".xTable-pageSizeSelector",N).prop("disabled",!1),a("input[type=button]:not(.editBtn,.deleteBtn)",N).button({disabled:!1}),0!==u.length&&ha.button({disabled:!1})),G(i,b),i},f.getEditedData=function(){var a=[];return E.forEach(function(b){f.orgSrc[b]&&a.push(f.orgSrc[b])}),a},f.sortBy=function(a,b){var c=new Worker(h+"/workers/XTableSort.js");return 0!==F?void alert("请先保存当前正在编辑的行！"):(ja("正在排序，请稍候..."),c.postMessage({src:f.src,name:a,order:b}),void(c.onmessage=function(a){ka(),f.src=a.data,f.init(),c.terminate()}))},f.deleteSelectedData=function(){var b,c=f.getSelectedData();return 0!==F?void alert("请先保存当前正在编辑的行！"):void(A(c,f.orgSrc)&&(ja("正在删除，请稍候..."),b=new Worker(h+"/workers/XTableDelete.js"),b.postMessage({selectedData:c,orgSrc:f.orgSrc}),b.onmessage=function(d){f.orgSrc=d.data,f.src=f.orgSrc.slice(),f.src.forEach(function(a,b){a.selected=!1,a.orgIndex=b}),ka(),a(O).find(".cFilterData").remove(),a(O).find(".resetData").remove(),a(ha).button({disabled:!0}),f.init(),b.terminate(),B(c,f.orgSrc)}))},f.extendFunction=function(b){var c=a("<input type='button' value='"+b.fName+"' class='funcButton'/>");return c.appendTo(f.pageController).button({disabled:b.disabled}).click(function(){a.proxy(b.handler,this)(f.getSelectedData(),f.orgSrc)}),b.className&&c.addClass(b.className),b.style&&(c[0].style=c[0].style+";"+b.style),c},f.addRow=function(b,c,d){void 0===b&&(b={}),c&&c(b,f.orgSrc),o.forEach(function(a){void 0===b[a]&&(b[a]="")}),b.selected=!1,b.orgIndex=f.orgSrc.length,f.src.push(b),f.orgSrc.push(a.extend({},b,!0)),f.init(),f.toLastPage(),f.view.find(".dataTr").last().find(".editTd").find("input").click(),f.view.find(".dataTr").last().find("input[type=text]").first().focus(),d&&d(b,f.orgSrc)},f.filter=function(){var c=b.XFilter({src:[],id:f.id+"-filter",filterType:k}),d=c.id,e=c.filterDiv,g=e.parent(),i="",j="",l=c.selectedNames;return g.css("width","auto").css("font-size","16px"),e.dialog({open:function(){b.helpers.addShield(document.body)}}),g.appendTo(N),c.loadFilterOverride=function(a,b){c.src=[],j=b,f.src.forEach(function(a){c.src.push(a[b])}),c.loadFilter(a)},c.cFilterdata=function(){var b;return 0!==F?void alert("请先保存当前正在编辑的行！"):void(f.src.length!==f.orgSrc.length&&(a(".orderTag",N).empty(),ja("正在过滤，请稍候..."),b=new Worker(h+"/workers/XTableCFilter.js"),b.postMessage({src:f.src,orgSrc:f.orgSrc}),b.onmessage=function(a){ka(),f.src=a.data,f.init()}))},c.filterData=function(){var b;l=c.selectedNames,ja("正在过滤，请稍候..."),e.dialog("close"),b=new Worker(h+"/workers/XTableFilterData.js"),b.postMessage({src:f.src,selectedNames:l,filterSrcName:j}),b.onmessage=function(c){var e,g;ka(),a("#"+d+"-cFilterData",N).remove(),f.src=c.data,f.init(),a("#"+d+"-resetData",N).remove(),f.src.length!==f.orgSrc.length&&(e=a("<input type='button' class='resetData' id='"+d+"-resetData' style=''value='重置过滤器'/>"),g=a("<input type='button' class='cFilterData' id='"+d+"-cFilterData' value='反向过滤'/>"),e.insertAfter(Q),e.button(),g.insertAfter(e),g.button()),b.terminate()}},c.resetData=function(){b.helpers.addShield(),f.src=f.orgSrc.slice(),a(".orderTag",N).empty(),a("#"+d+"-resetData",N).remove(),a("#"+d+"-cFilterData",N).remove(),a(".orderTag",N).empty(),b.helpers.removeShield(),f.init()},a(".openFilterLi",N).click(function(b){var d,f,g=e.dialog("isOpen");return b.stopPropagation(),0!==F?void alert("请先保存当前正在编辑的行！"):void(g||(d=a(this).prev().html(),f=a(this.parentNode).attr("srcname"),c.loadFilterOverride(d,f)))}),a(N).undelegate("#"+d+"-resetData","click"),a(N).delegate("#"+d+"-resetData","click",function(){c.resetData()}),a(g).undelegate("#"+d+"-startFilter","click"),a(g).delegate("#"+d+"-startFilter","click",function(){c.filterData()}),a(N).undelegate("#"+d+"-cFilterData","click"),a(N).delegate("#"+d+"-cFilterData","click",function(){c.cFilterdata()}),a("#"+d+"-resetFilter",g).unbind().click(function(){a("#"+d+"-filterStr").val("请输入过滤关键字").select(),c.loadFilterOverride(i,j)}),c}(),ga.click(function(){var b=a(".dataTr",N).toArray();a(".selectRow",N).prop("checked",!0),b.forEach(function(b){a(b).attr("select")||f.selectRow(b)})}),T.click(function(){f.toFirstPage()}),R.click(function(){f.toPrevPage()}),V.keydown(function(a){var b;13===a.keyCode&&(b=parseInt(this.value),f.loadPage(b))}),S.click(function(){f.toNextPage()}),U.click(function(){f.toLastPage()}),da.click(function(){ca.dialog("open")}),z&&ha.click(function(){f.deleteSelectedData()}),a("#"+f.id+"-submitVCols",ca.parent()).click(function(){var b=a("#"+f.id+"-setVCols .vColCb",ca.parent()).toArray(),c=[];b.forEach(function(b){var d=a(b).is(":checked");d&&c.push(a(b).attr("srcName"))}),f.setVisibleCols(c),a(ca).dialog("close")}),a(".showAllCol",ca.parent()).change(function(){var b=a("#"+f.id+"-setVCols .vColCb",ca.parent());a(this).is(":checked")?b.prop("checked",!0):b.prop("checked",!1)}),a("#"+f.id+"-setVCols .vColCb",ca.parent()).change(function(){a(".showAllCol",ca.parent()).is(":checked")&&(a(this).is(":checked")||a(".showAllCol",ca.parent()).prop("checked",!1))}),a(N).undelegate(".xTable-pageSizeSelector","change"),a(N).delegate(".xTable-pageSizeSelector","change",function(){var a=this.options.selectedIndex;f.setPageSize(this.options[a].value)}),a(N).undelegate(".selectRow","change"),a(N).delegate(".selectRow","change",function(){var b=this.parentNode.parentNode;a(this).is(":checked")?f.selectRow(b):f.unselectRow(b)}),a(N).undelegate(".xTable-selectAll","change"),a(N).delegate(".xTable-selectAll","change",function(){a(this).is(":checked")?f.selectAll():f.unselectAll()}),a(N).undelegate(".dataTr","mouseover"),a(N).delegate(".dataTr","mouseover",function(){var b=a(this).attr("select");b||a(this).addClass("rowHover")}),a(N).undelegate(".dataTr","mouseout"),a(N).delegate(".dataTr","mouseout",function(){var b=a(this).attr("select");b||a(this).removeClass("rowHover")}),a(N).undelegate(".colName","click"),a(N).delegate(".colName","click",function(){var b=a(this).attr("srcname"),c=a(this).attr("sortable");if("true"===c){if(0!==F)return void alert("请先保存当前正在编辑的行！");a(this).attr("order")&&"desc"!==a(this).attr("order")?(a(this).attr("order","desc"),a(N).find(".orderTag").empty(),a(this).find(".orderTag").append("<img src='"+h+"/images/sort_desc.gif'>"),f.sortBy(b,"desc")):(a(this).attr("order","asc"),a(N).find(".orderTag").empty(),a(this).find(".orderTag").append("<img src='"+h+"/images/sort_asc.gif'/>"),f.sortBy(b,"asc"))}}),a(N).undelegate(".editBtn","click"),a(N).delegate(".editBtn","click",function(){var b=this.parentNode.parentNode,c=a(this).val();"编辑"===c?f.editRow(b):f.saveRow(b)}),a(N).undelegate(".editInput","focus"),a(N).delegate(".editInput","focus",function(){var a=this;setTimeout(function(){a.select()},200)}),a(N).undelegate(".dataCell","dblclick"),a(N).delegate(".dataCell","dblclick",function(){var b,c;C&&!a(this).attr("editInvalid")&&(b=this.parentNode,c=a(a(b).find(".editBtn")).val(),"编辑"===c&&f.editRow(b),a(this).find("input").focus())}),a(N).undelegate(".editInput","keydown"),a(N).delegate(".editInput","keydown",function(b){var c;13===b.keyCode&&(c=a(this.parentNode.parentNode).find(".editBtn"),"保存"===a(c).val()&&a(c).click())}),f.init(),f},b.XFilter=function(c){var d=b.helpers.log,e=b.helpers.error,f={},g=c.id||"XFilter-"+b.helpers.guid(),h=c.startFilterText||"确定",i=c.closeFilterText||"取消",j=c.startFilterHandler||function(a,b){b.filterDiv.dialog("close")},k=c.closeFilterHandler||function(a,b){b.filterDiv.dialog("close")},l=c.filterType||2,m=c.title||"",n=b.config.rootPath,o=a("<div style='display:table' title='过滤器'></div>");a(o).attr("id",g),o.dialog({autoOpen:!1,resizable:!1,title:m,buttons:[{text:h,id:g+"-startFilter",click:function(){j(f.selectedNames,f)}},{text:i,id:g+"-closeFilter",click:function(){k(f.selectedNames,f)}}],position:{my:"top+10%",at:"top+10%",of:window},close:function(){b.helpers.removeShield(),o.removeData("allNamesCatch"),o.removeData("sNamesCatch")},open:function(){b.helpers.addShield(),o.removeData("allNamesCatch"),o.removeData("sNamesCatch")}});var p=o.parent(),q=a("<div class='xFilter-searchDiv'><div><input type='text' value='请输入过滤关键字' class='xFilter-filterStr' id='"+g+"-filterStr'/></div><div><input type='button' class='XFilter-searchBtn' value='搜索' id='"+g+"-filterSubmit'/></div><div><input type='button' class='XFilter-resetBtn' value='重置' id='"+g+"-resetFilter'/></div></div>"),r=a("<input type='radio' value='completeMatch' id='completeMatch' name='matchType'/>"),s=a("<input type='radio' value='partialMatch' id='partialMatch' checked='checked' name='matchType'/>"),t="partial",u=a("<div class='matchRadios'></div>"),v=a("<div></div>").append(r).append("<span class='xFilter-radioSpan'>完全匹配</span>"),w=a("<div></div>").append(s).append("<span class='xFilter-radioSpan'>部分匹配</span>"),x=a("<div class='xFilter-filterResult' id='xFilter-filterResult'></div>");if(u.append(w).append(v),q.append(u),o.append(q).append(x),!n||""===n)throw e("XFilter: 配置参数有误，请检查myUtil.config对象中的root属性");if(!c.src)throw e("XFilter: 配置参数有误，请检查option对象的src属性");return f.option=c,f.src=c.src,f.allNames=[],f.selectedNames=[],f.tempAllNames=[],f.id=c.id||"XFilter-"+b.helpers.guid(),f.filterType=l,f.matchType=t,f.filterDiv=o,f.filterResult=x,f.startFilterBtn=a("#"+g+"-startFilter",p)[0],f.closeFilterBtn=a("#"+g+"-closeFilter",p)[0],f.completeMatch=r,f.partialMatch=s,f.loadFilter=function(b){var c,e,h,i=o.data("allNamesCatch"),j=o.data("sNamesCatch");b&&o.dialog({title:b}),o.dialog("open"),p.css("width","auto"),a("input[type=button]",o).button(),a("#"+g+"-filterStr",p).val("请输入过滤关键字").select(),s.prop("checked",!0),r.prop("checked",!1),o.find(".XFilter-matchResult").remove(),a(x).empty().append("正在加载关键字，请稍候..."),a("#"+g+"-startFilter").button({disabled:!0}),f.tempAllNames=[],i&&j?(d("XFilter.loadFilter: 从缓存加载关键字."),h=a("<div id='xFilter-fSelectAllSpan'><input type='checkbox' class='"+g+"-fselectAll' checked='checked' id='"+g+"-fselectAll'><span class='xFilter-nameTag'>全部</span></div>"),x.empty().append(h),a("#"+g+"-startFilter",p).button({disabled:!1}),f.allNames=i,f.selectedNames=j,f.allNames.forEach(function(b,c){var d;1e3>c&&(d=a("<div class='nameCell'><input type='checkbox' class='"+g+"-nameCb' key='"+b+"' checked='checked'/><span class='xFilter-nameTag'>"+b+"</span></div>"),x.append(d))})):(d("XFilter.loadFilter: 未找到缓存，将直接加载关键字."),c=new Worker(n+"/workers/XFilterGetKeys.js"),e={src:f.src},c.postMessage(e),c.onmessage=function(b){var d=b.data,e=d.names,i=d.sNames;h=a("<div id='xFilter-fSelectAllSpan'><input type='checkbox' class='"+g+"-fselectAll' checked='checked' id='"+g+"-fselectAll'><span class='xFilter-nameTag'>全部</span></div>"),a("#"+g+"-startFilter",p).button({disabled:!1}),x.empty().append(h),f.allNames=e,f.selectedNames=i,e.forEach(function(b,c){var d;1e3>c&&(d=a("<div class='nameCell'><input type='checkbox' class='"+g+"-nameCb' key='"+b+"' checked='checked'><span class='xFilter-nameTag'>"+b+"</span></div>"),x.append(d))}),o.data("allNamesCatch",f.allNames),o.data("sNamesCatch",f.selectedNames),c.terminate()})},f.selectName=function(a){-1===f.selectedNames.indexOf(a)&&f.selectedNames.push(a)},f.unselectName=function(b){var c=f.selectedNames.indexOf(b);-1!==c&&f.selectedNames.splice(c,1),a("#"+g+"fselectAll",p).prop("checked",!1)},f.searchByName=function(b,c){var e,h,i,j,k,m,n,o,p,q,s=[],t=f.allNames,v=[],w=f.filterResult,x="",y=b.split(/\s+/),z=a("<div id='tSelectAll'><input type='checkbox' checked='checked' class='"+g+"-fselectAll' id='"+g+"-fselectAll'><span class='xFilter-nameTag'>全部</span></div>");for(c?x=c:(x="partial",a(r).is(":checked")&&(x="complete")),b=b.replace(/[\u3002\uff1b\uff0c\uff1a\u201c\u201d\uff08\uff09\u3001\uff1f\u300a\u300b]|\s|\,|\.|\?/g," ").trim().toLowerCase(),e=0;e<y.length;e++)if(j=y[e].trim(),""!==j)for(h=0;h<t.length;h++){if(k=t[h].toString(),m=t[h].toString().toLowerCase(),n=!0,"partial"===x)if(1===parseInt(l))if(isNaN(Number(j))){for(i=0;i<j.length;i++)if(-1===m.search(j.charAt(i))){n=!1;break}if(n){var A=[];for(i=0;i<j.length;i++)if(-1!==m.search(j.charAt(i)))if(o=m.indexOf(j.charAt(i)),p=m.lastIndexOf(j.charAt(i)),0===A.length)A.push(o);else{if(p<A[A.length-1]){n=!1;break}A.push(o>A[A.length-1]?o:p)}}}else isNaN(j)||isNaN(parseInt(m))?!isNaN(j)&&isNaN(parseInt(m))&&(n=!0,-1===m.toString().search(""+j)&&(n=!1)):(n=!1,0===m.toString().search(""+j)&&(n=!0));else n=!1,-1!==m.search(j)&&(n=!0);else n=!1,m===j&&(n=!0);n&&(-1===s.indexOf(k)&&s.push(k),-1===v.indexOf(k)&&v.push(k))}for(w.empty().append(z),e=0;e<v.length&&500>e;e++)m=v[e],q=a("<div class='nameCell'><input type='checkbox' checked='checked' class='"+g+"-nameCb' key='"+m+"' index='"+e+"'><span class='xFilter-nameTag'>"+m+"</span></div>"),w.append(q);u.find(".XFilter-matchResult").remove(),u.append("<span class='XFilter-matchResult'>共匹配到<span class='red'>"+v.length+"</span>条关键字</span>"),f.selectedNames=s,f.tempAllNames=v,d(f.selectedNames)},f.fSelectAll=function(){f.selectedNames=[],0===f.tempAllNames.length?f.allNames.forEach(function(a){f.selectedNames.push(a)}):f.tempAllNames.forEach(function(a){f.selectedNames.push(a)})},f.fUnselectAll=function(){f.selectedNames=[]},a("#"+g+"-filterStr",p).unbind().focus(function(){var a=this;setTimeout(function(){a.select()},200)}),a("#"+g+"-filterStr",p).keydown(function(b){13===b.keyCode&&a("#"+g+"-filterSubmit",p).click()}),a("#"+g+"-filterSubmit",p).unbind().click(function(){var b,c=a("#"+g+"-filterStr",p).val();""!==c&&"请输入过滤关键字"!==c?(b="partial",a(r).is(":checked")&&(b="complete"),f.searchByName(c,b)):a("#"+g+"-resetFilter",p).click()}),a(p).undelegate("."+g+"-nameCb","change"),a(p).delegate("."+g+"-nameCb","change",function(){var b=a(this).is(":checked"),c=a(this).attr("key");b?f.selectName(c):(f.unselectName(c),a("."+g+"-fselectAll",p).prop("checked",!1))}),a(p).undelegate("."+g+"-fselectAll","change"),a(p).delegate("."+g+"-fselectAll","change",function(){var b=a(this).is(":checked");b?(a("."+g+"-nameCb",p).prop("checked",!0),f.fSelectAll()):(a("."+g+"-nameCb",p).prop("checked",!1),f.fUnselectAll())}),a("#"+g+"-resetFilter",p).unbind().click(function(){a("#"+g+"-filterStr",p).val("请输入过滤关键字").select(),f.loadFilter()}),f},b.XWaterfall=function(c){var d=b.helpers.log,e=c.url||"",f=a.isArray(c.src)?c.src:[],g=a.isNumeric(Math.floor(c.colNum))?Math.floor(c.colNum):5,h=c.renderTo||document.body,i=a.isNumeric(c.colWidth)?c.colWidth:236,j=a.isNumeric(c.contentWidth)?c.contentWidth:234,k=a.isNumeric(Math.floor(c.initialSize))?c.initialSize:10*g,l=a.isNumeric(c.marginTop)?c.marginTop:10,m=a.isNumeric(c.fetchSize)?c.fetchSize:5*g,n=a.isFunction(c.renderer)?c.renderer:function(a){return a},o=a.isFunction(c.onFetch)?c.onFetch:function(){d("XWaterfall: fetching...")},p=a.isFunction(c.fetchCallback)?c.fetchCallback:function(a){d("XWaterfall: "+a)},q=[],r=[],s=[],t=[],u=0,v=0,w=0,x=!0,y=function(a){var b,c,d=t[0],e=t[0].currentHeight;for(b=0;b<t.length;b++)c=t[b],c.currentHeight<e&&(e=c.currentHeight,d=c);return d.append(a,"new"),s.push(a),d},z=function(){var a=[];t.forEach(function(b){a.push(b.currentTop)}),u=Math.max.apply(window,a)},A=function(){var a=[];t.forEach(function(b){a.push(b.currentHeight)}),v=Math.min.apply(window,a)},B=function(){var a=[];t.forEach(function(b){a.push(b.currentHeight)}),w=Math.max.apply(window,a)},C={};return C.set=function(b){return a.isNumeric(b.initialSize)&&(k=b.initialSize),a.isNumeric(b.colWidth)&&(i=b.colWidth),a.isNumeric(b.marginTop)&&(l=b.marginTop),a.isNumeric(b.fetchSize)&&(m=b.fetchSize),a.isNumeric(b.colNum)&&(g=b.colNum),a.isNumeric(b.contentWidth)&&(j=b.contentWidth),a.isFunction(b.onFetch)&&(o=b.onFetch),a.isFunction(b.fetchCallback)&&(p=b.fetchCallback),"url"in b&&(e=b.url),C},C.fetch=function(){var b,c,g;if(c=s.length,c<f.length)for(b=c;c+m>b;b++){if(!(b<f.length)){C.fetch();break}g=y(f[b]),q.push(g.shift())}else{if(""===e)return void(x=!1);o(h),x=!1,a.get(e,{fetchSize:m,currentSize:s.length}).done(function(a){"success"===a.message?a.src.length===m?(a.src.forEach(function(a){var b=y(a);q.push(b.shift())}),x=!0,p("success",h,a.src.length)):(d("XWaterfall: fetch failed, data.src.length is not equal to fetchsize."),x=!1):"all loaded"===a.message?(d("XWaterfall: no more resource!"),x=!1,p("allLoaded",h,a.src.length)):(d("XWaterfall: exception:"+a.message),x=!1,p("exception",h,a.src.length))}).fail(function(){d("XWaterfall: fetch failed!"),x=!1,p("error",h,data.src.length)})}return z(),A(),B(),a(h).css("height",w),C},C.reAttach=function(a){var b,c,d;return"top"===a?(b=q.pop(),b&&(c=b.col,d=t[c],d.prepend(b),r.push(d.pop()))):"bottom"===a&&(b=r.pop(),b&&(c=b.col,d=t[c],d.append(b,"old"),q.push(d.shift()))),z(),A(),B(),C},C.init=function(){var c,d;for(s=[],q=[],r=[],t=[],u=0,v=0,w=0,x=!0,a(h).empty().css("min-height",0).css("height",0).css("position","relative"),c=0;g>c;c++){var e=function(a){var b=["<div style='left:",a.left,"px;top:",a.top,"px;width:",j,"px;height:",a.height,"px;' id='",a.id,"' class='XWaterfall-component'>",n(a.model),"</div>"];return b.join("")};d={index:c,targetLeft:i*c,components:[],currentTop:a(h).offset().top,currentHeight:0,append:function(c,d){var f,g,i,k,m=this,o={};"new"===d?(i=b.helpers.guid(),k=0===m.currentHeight?0:m.currentHeight+l,f=n(c),g=a("<div class='XWaterfall-component'>"+f+"</div>"),g.css("width",j).attr("id",i).appendTo(h).css("left",m.targetLeft).css("top",k),o.col=m.index,m.components.push(o),o.index=m.components.indexOf(o),o.id=i,o.top=k,o.left=m.targetLeft,o.height=g.outerHeight(),o.model=c,1===m.components.length?m.currentHeight=o.height:m.currentHeight+=o.height+l):(f=e(c),a(h).append(f),m.components.push(c),1===m.components.length?m.currentHeight=c.height:m.currentHeight+=c.height+l)},prepend:function(b){var c=this,d=e(b);a(h).append(d),c.components.unshift(b),c.currentTop>0&&(c.currentTop=parseInt(c.components[0].top))},shift:function(){var b=this,c=b.components.shift();return a("#"+c.id).remove(),b.currentTop=parseInt(b.components[0].top),c},pop:function(){var b=this,c=b.components.pop();return a("#"+c.id).remove(),b.currentHeight=b.currentHeight-c.height-l,c}},t.push(d)}for(c=0;k>c;c++)c<f.length&&y(f[c]);return B(),a(h).css("height",w),a(document).scrollTop(0),C},function(){var b=0;a(document).off("scroll.XWaterfall"),a(document).on("scroll.XWaterfall",function(){var c=a(document).scrollTop(),d=a(document).scrollTop()+a(window).height(),e=a(document).height(),f=e-d,g=c-u,h=v-d,i=c-b>0;if(i){if(0===r.length)x&&100>f&&C.fetch();else if(100>h)if(h>=0)C.reAttach("bottom");else for(;v<a(document).scrollTop()+a(window).height()&&r.length>0;)C.reAttach("bottom")}else if(100>g&&q.length>0)if(g>=0)C.reAttach("top");else for(;u>a(document).scrollTop()&&q.length>0;)C.reAttach("top");b=c})}(),C.init(),C},b.helpers.preloadImages(b.config.rootPath+"/images/sort_asc.gif",b.config.rootPath+"/images/sort_desc.gif",b.config.rootPath+"/images/closebtn.png",b.config.rootPath+"/images/closebtn-hover.png"),c.XUtil=b,c.myUtil=b,b});