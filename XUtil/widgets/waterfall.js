!function(a){"function"==typeof define&&define.amd?define(["jquery","jquery-ui"],a):a(jQuery)}(function(a){"use strict";var b={},c=window;return b.config={rootPath:"XUtil"},b.helpers={log:function(){var a=Array.prototype.slice.apply(arguments,[]);a.unshift("(XUtil) "),console.log.apply(console,a)},error:function(){if(arguments[0]){var a="(XUtil) "+arguments[0].toString();return new Error(a)}},shimConsole:function(){var a=function(){};window.console||(window.console={log:a,error:a,warn:a})},addShield:function(b,c,d){var e,f,g,h,i,j=d||1e4;return!b&&(b=document.body),b=a(b),e=b.offset().top,f=b.offset().left,g=b.outerWidth(),h=b.outerHeight(),b[0]===document.body&&(g="100%",h="100%"),a.isNumeric(c)||(c=.3),i=a("<div class='XUtil-pageShield'></div>"),i.css("position","absolute").css("z-index",j).css("background","#000").css("opacity",c).css("top",e).css("left",f).css("width",g).css("height",h).appendTo(document.body),i},removeShield:function(b){b?a(".XUtil-pageShield").remove():a(b).remove()},showErrorHint:function(b,c,d){var e=a(b.parentNode),f=a("<span class='errorHint'>* "+c+"</span>");return 0===e.find(".errorHint").length&&f.insertAfter(b),d&&f.addClass(d),f},clearErrorHint:function(b){b?a(a(b).parent()).find(".errorHint").remove():a(".errorHint").remove()},getUrlArgs:function(){var a,b,c,d,e={},f=window.location||f,g=f.search.substring(1),h=g.split("&");for(a=0;a<h.length;a++)b=h[a].indexOf("="),-1!==b&&(c=h[a].substring(0,b),d=decodeURI(h[a].substring(b+1)),e[c]=d);return e},toQuery:function(a){var b="?";for(var c in a)a.hasOwnProperty(c)&&(b+=c+"="+a[c]+"&");return b},getUrl:function(a,b){var c=helpers;return encodeURI(a+c.toQuery(b))},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:0&b&3|8;return c.toString(16)}).toUpperCase()},preloadImages:function(){var a;for(a=0;a<arguments.length;a++)(new Image).src=arguments[a].toString()},safeEvent:function(b,c,d,e){var f,g,h=!1;c=c||window,d=d||300;var i=function(a){f=a,b.apply(c,g)};return function(){var b,c=a.now();g=Array.prototype.slice.apply(arguments),h?c-f>d&&i(c):(h=!0,i(c),e&&(b=setInterval(function(){var c=a.now();c-f>=e&&(i(c),clearInterval(b),h=!1)},d/10)))}},loadImg:function(b,c){var d,e=-1!==navigator.userAgent.search("MSIE 6.0"),f=-1!==navigator.userAgent.search("MSIE 7.0"),g=b.getAttribute("real-src"),h=1===parseInt(b.getAttribute("loaded"),10);b.getAttribute("img-index");(!h||e||f)&&(d=a(new Image),d.on("load",function(){a(b).attr({src:g,loaded:1}),c&&c(),d.remove()}).attr("src",g))}},b.helpers.shimConsole(),b.XWaterfall=function(c){var d=b.helpers.log,e=c.url||"",f=a.isArray(c.src)?c.src:[],g=a.isNumeric(Math.floor(c.colNum))?Math.floor(c.colNum):5,h=c.renderTo||document.body,i=a.isNumeric(c.colWidth)?c.colWidth:236,j=a.isNumeric(c.contentWidth)?c.contentWidth:234,k=a.isNumeric(Math.floor(c.initialSize))?c.initialSize:10*g,l=a.isNumeric(c.marginTop)?c.marginTop:10,m=a.isNumeric(c.fetchSize)?c.fetchSize:5*g,n=a.isFunction(c.renderer)?c.renderer:function(a){return a},o=a.isFunction(c.onFetch)?c.onFetch:function(a){d("XWaterfall: fetching...")},p=a.isFunction(c.fetchCallback)?c.fetchCallback:function(a,b,c){d("XWaterfall: "+a)},q=c.fetchSizeAttr||"fetchSize",r=c.currentSizeAttr||"currentSize",s=[],t=[],u=[],v=[],w=0,x=0,y=0,z=!0,A=function(a){var b,c,d=v[0],e=v[0].currentHeight;for(b=0;b<v.length;b++)c=v[b],c.currentHeight<e&&(e=c.currentHeight,d=c);return d.append(a,"new"),u.push(a),d},B=function(){var a=[];v.forEach(function(b){a.push(b.currentTop)}),w=Math.max.apply(window,a)},C=function(){var a=[];v.forEach(function(b){a.push(b.currentHeight)}),x=Math.min.apply(window,a)},D=function(){var a=[];v.forEach(function(b){a.push(b.currentHeight)}),y=Math.max.apply(window,a)},E={};return E.set=function(b){return a.isNumeric(b.initialSize)&&(k=b.initialSize),a.isNumeric(b.colWidth)&&(i=b.colWidth),a.isNumeric(b.marginTop)&&(l=b.marginTop),a.isNumeric(b.fetchSize)&&(m=b.fetchSize),a.isNumeric(b.colNum)&&(g=b.colNum),a.isNumeric(b.contentWidth)&&(j=b.contentWidth),a.isFunction(b.onFetch)&&(o=b.onFetch),a.isFunction(b.fetchCallback)&&(p=b.fetchCallback),"url"in b&&(e=b.url),E},E.fetch=function(){var b,c,g,i={};if(c=u.length,c<f.length)for(b=c;c+m>b;b++){if(!(b<f.length)){E.fetch();break}g=A(f[b]),s.push(g.shift())}else{if(""===e)return void(z=!1);o(h),z=!1,i[q]=m,i[r]=currentSize,a.get(e,i).done(function(a){"success"===a.message?a.src.length===m?(a.src.forEach(function(a){var b=A(a);s.push(b.shift())}),z=!0,p("success",h,a.src.length)):(d("XWaterfall: fetch failed, data.src.length is not equal to fetchsize."),z=!1):"all loaded"===a.message?(d("XWaterfall: no more resource!"),z=!1,p("allLoaded",h,a.src.length)):(d("XWaterfall: exception:"+a.message),z=!1,p("exception",h,a.src.length))}).fail(function(){d("XWaterfall: fetch failed!"),z=!1,p("error",h,data.src.length)})}return B(),C(),D(),a(h).css("height",y),E},E.reAttach=function(a){var b,c,d;return"top"===a?(b=s.pop(),b&&(c=b.col,d=v[c],d.prepend(b),t.push(d.pop()))):"bottom"===a&&(b=t.pop(),b&&(c=b.col,d=v[c],d.append(b,"old"),s.push(d.shift()))),B(),C(),D(),E},E.init=function(){var c,d;for(u=[],s=[],t=[],v=[],w=0,x=0,y=0,z=!0,a(h).empty().css("min-height",0).css("height",0).css("position","relative"),c=0;g>c;c++){var e=function(a){var b=["<div style='left:",a.left,"px;top:",a.top,"px;width:",j,"px;height:",a.height,"px;' id='",a.id,"' class='XWaterfall-component'>",n(a.model),"</div>"];return b.join("")};d={index:c,targetLeft:i*c,components:[],currentTop:a(h).offset().top,currentHeight:0,append:function(c,d){var f,g,i,k,m=this,o={};"new"===d?(i=b.helpers.guid(),k=0===m.currentHeight?0:m.currentHeight+l,f=n(c),g=a("<div class='XWaterfall-component'>"+f+"</div>"),g.css("width",j).attr("id",i).appendTo(h).css("left",m.targetLeft).css("top",k),o.col=m.index,m.components.push(o),o.index=m.components.indexOf(o),o.id=i,o.top=k,o.left=m.targetLeft,o.height=g.outerHeight(),o.model=c,1===m.components.length?m.currentHeight=o.height:m.currentHeight+=o.height+l):(f=e(c),a(h).append(f),m.components.push(c),1===m.components.length?m.currentHeight=c.height:m.currentHeight+=c.height+l)},prepend:function(b){var c=this,d=e(b);a(h).append(d),c.components.unshift(b),c.currentTop>0&&(c.currentTop=parseInt(c.components[0].top))},shift:function(){var b=this,c=b.components.shift();return a("#"+c.id).remove(),b.currentTop=parseInt(b.components[0].top),c},pop:function(){var b=this,c=b.components.pop();return a("#"+c.id).remove(),b.currentHeight=b.currentHeight-c.height-l,c}},v.push(d)}for(c=0;k>c;c++)c<f.length&&A(f[c]);return D(),a(h).css("height",y),a(document).scrollTop(0),E},function(){var b=0;a(document).off("scroll.XWaterfall"),a(document).on("scroll.XWaterfall",function(){var c=a(document).scrollTop(),d=a(document).scrollTop()+a(window).height(),e=a(document).height(),f=e-d,g=c-w,h=x-d,i=c-b>0;if(i){if(0===t.length)z&&100>f&&E.fetch();else if(100>h)if(h>=0)E.reAttach("bottom");else for(;x<a(document).scrollTop()+a(window).height()&&t.length>0;)E.reAttach("bottom")}else if(100>g&&s.length>0)if(g>=0)E.reAttach("top");else for(;w>a(document).scrollTop()&&s.length>0;)E.reAttach("top");b=c})}(),E.init(),E},c.XUtil=b,c.myUtil=b,b});